<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Cognitive Rehabilitation Micro-Apps</title>
<script>
  /* ==== Catalog â†’ clickable cards (docs/apps/*.html) ==== */
  const grid = document.getElementById('grid');

  function getBasePath(){
    const parts = (location.pathname || "/").split("/").filter(Boolean);
    // e.g. /micro-apps-repository
    return parts.length ? `/${parts[0]}` : "";
  }
  const BASE = getBasePath();

  async function loadJson(paths){
    for (const p of paths){
      try{
        const r = await fetch(p, { cache: 'no-store' });
        if (r.ok) return await r.json();
      }catch(e){}
    }
    throw new Error('catalog.json not found in expected locations');
  }

  (async () => {
    const catalog = await loadJson([
      `${BASE}/catalog.json`,
      `${BASE}/docs/catalog.json`,
      `${BASE}/shared/catalog.json`
    ]);

    const cards = catalog.map(app => {
      const a = document.createElement('a');
      a.className = 'card';
      // âœ… point to docs/apps/<slug>.html
      a.href = `${BASE}/docs/apps/${app.slug}.html`;
      a.innerHTML = `
        <div class="title">${app.emoji ?? 'ðŸ§©'} ${app.title}</div>
        <p class="desc">${app.description ?? ''}</p>
        ${Array.isArray(app.tags) ? `<div class="tags">${app.tags.map(t=>`<span class="tag">${t}</span>`).join('')}</div>` : ''}
      `;
      return a;
    });

    grid.replaceChildren(...cards);
  })().catch(err => {
    console.error(err);
    grid.innerHTML = `<p class="desc">Could not load catalog. Check that <code>catalog.json</code> exists.</p>`;
  });
</script>
</head>
<body>
<!-- Particle background -->
<div id="tsparticles"></div>

<header>
  <div class="header-inner">
    <h1>Cognitive Rehabilitation Micro-Apps</h1>
    <p class="subtitle">Interactive, lightweight tools to support assessment, practice, and research in cognitive rehabilitation.</p>
  </div>
</header>

<main>
  <div id="grid" class="grid"></div>
</main>

<!-- tsParticles -->
<script src="https://cdn.jsdelivr.net/npm/tsparticles@2/tsparticles.bundle.min.js"></script>
<script>
  /* ==== Particle network background ==== */
  tsParticles.load("tsparticles", {
    background: { color: "#f9fafb" },
    particles: {
      number: { value: 60, density: { enable: true, value_area: 800 } },
      color: { value: "#94a3b8" },
      shape: { type: "circle" },
      opacity: { value: 0.5 },
      size: { value: 2 },
      line_linked: { enable: true, distance: 120, color: "#cbd5e1", opacity: 0.4, width: 1 },
      move: { enable: true, speed: 1.2, direction: "none", outModes: { default: "bounce" } }
    },
    interactivity: {
      detectsOn: "canvas",
      events: { onhover: { enable: true, mode: "grab" }, resize: true },
      modes: { grab: { distance: 140, line_linked: { opacity: 0.7 } } }
    },
    retina_detect: true
  });

  /* ==== Catalog â†’ clickable cards ==== */
  const grid = document.getElementById('grid');

  function getBasePath(){
    const parts = (location.pathname || "/").split("/").filter(Boolean);
    return parts.length ? `/${parts[0]}` : "";
  }
  const BASE = getBasePath();

  async function loadCatalog(){
    try{
      const res = await fetch(`${BASE}/catalog.json`, { cache: 'no-store' });
      const catalog = await res.json();

      const cards = catalog.map(app => {
        const card = document.createElement('a');
        card.className = 'card';
        card.href = `${BASE}/apps/${app.slug}.html`;
        card.innerHTML = `
          <div class="title">${app.emoji} ${app.title}</div>
          <p class="desc">${app.description}</p>
          ${app.tags ? `<div class="tags">${app.tags.map(t=>`<span class="tag">${t}</span>`).join('')}</div>` : ''}
        `;
        return card;
      });

      grid.replaceChildren(...cards);
    }catch(err){
      console.error('Failed to load catalog.json', err);
      grid.innerHTML = `<p class="desc">Could not load catalog. Make sure <code>catalog.json</code> is in the right folder.</p>`;
    }
  }

  loadCatalog();
</script>
</body>
</html>
