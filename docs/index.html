<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cognitive Rehabilitation Micro-Apps</title>
<meta name="description" content="Interactive, lightweight tools to support assessment, practice, and research in cognitive rehabilitation." />
<link rel="preload" href="catalog.json" as="fetch" crossorigin="anonymous" />

<style>
  /* ===== Design tokens ===== */
  :root{
    color-scheme: light dark;
    --bg:#f7f8fb; --surface:#ffffff; --text:#1f2937; --muted:#6b7280; --line:#e5e7eb;
    --accent:#ff7a6e; --accent-600:#ff6254; --accent-700:#f24f40;
    --pill:#f2f4f7; --radius:16px;
    --shadow:0 1px 2px rgba(16,24,40,.06),0 8px 24px rgba(16,24,40,.08);
  }
  :root[data-theme="dark"]{
    color-scheme: dark;
    --bg:#0b1020; --surface:#121829; --text:#e8ecf2; --muted:#a1a9b8; --line:#22293a;
    --pill:#1a2236; --accent:#ff7a6e; --accent-600:#ff7a6e; --accent-700:#ff7a6e;
    --shadow:none;
  }

  /* ===== Base ===== */
  html,body{ height:100%; margin:0; background:var(--bg); color:var(--text);
    font-family: system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif; }
  a{ color:inherit; text-decoration-thickness: .08em; text-underline-offset: .18em; }

  /* ===== Header (title centered; tiny menu for settings) ===== */
  .site-header{ position:sticky; top:0; z-index:30; padding:.75rem 3rem;
    backdrop-filter:saturate(180%) blur(8px); }
  .hdr-title{ margin:0; text-align:center; line-height:1.1;
    font-size:clamp(22px,5.5vw,36px); }
  .hdr-menu{ position:absolute; right:.75rem; top:.5rem; width:40px; height:40px;
    border-radius:999px; background:transparent; border:1px solid var(--line); color:var(--text); }

  .hero-sub{ margin:.35rem auto 1rem; text-align:center; color:var(--muted);
    max-width:42ch; font-size:clamp(14px,3.6vw,18px); }

  /* ===== Layout ===== */
  .container{ max-width:1000px; margin:0 auto; padding:0 1rem; }
  .page{ min-height:100dvh; display:flex; flex-direction:column; }
  .main{ flex:1; min-height:0; }

  /* ===== Controls ===== */
  #controls{ position:sticky; top:64px; z-index:20; background:var(--bg);
    padding:.5rem 0 .75rem; border-bottom:1px solid var(--line); }
  .controls-grid{ display:grid; grid-template-columns:1fr; gap:.5rem; }
  .row{ display:flex; gap:.5rem; align-items:center; }
  .search{ flex:1; height:44px; border-radius:12px; border:1px solid var(--line);
    padding:0 .75rem; background:var(--surface); color:var(--text); }
  .select{ height:44px; border-radius:12px; border:1px solid var(--line);
    padding:0 .6rem; background:var(--surface); color:var(--text); }
  .btn{ height:44px; border-radius:12px; border:1px solid var(--line);
    background:var(--surface); color:var(--text); padding:0 .9rem; }
  .tags{ display:flex; gap:.5rem; overflow-x:auto; padding:.25rem 0; }
  .tag{ display:inline-flex; align-items:center; border-radius:999px; padding:.3rem .7rem;
    background:var(--pill); border:1px solid var(--line); white-space:nowrap; cursor:pointer; }
  .tag[aria-pressed="true"]{ background:var(--accent); color:white; border-color:transparent; }

  .count{ color:var(--muted); font-size:.95rem; margin:.5rem 0 0; }

  /* ===== Cards ===== */
  #cardList{ padding: .75rem 0 2.5rem; }
  .card{ background:var(--surface); border:1px solid var(--line); border-radius:20px;
    box-shadow:var(--shadow); padding:1rem; margin:.6rem 0; }
  .card h3{ margin:.1rem 0 .3rem; font-size:1.1rem; line-height:1.2; }
  .card p{ margin:.25rem 0 .6rem; color:var(--muted); }
  .pillrow{ display:flex; gap:.35rem; flex-wrap:wrap; }
  .pill{ font-size:.85rem; padding:.25rem .55rem; border-radius:999px; background:var(--pill);
    border:1px solid var(--line); }

  /* ===== Settings sheet ===== */
  dialog.sheet{ border:0; padding:0; width:min(520px,92vw); border-radius:16px; }
  .sheet::backdrop{ background:rgba(0,0,0,.35); }
  .sheet-body{ padding:1rem 1rem 1.25rem; background:var(--surface); color:var(--text);
    border:1px solid var(--line); border-radius:16px; }
  .sheet h2{ margin:.25rem 0 1rem; font-size:1.1rem; }
  .sheet fieldset{ border:1px solid var(--line); border-radius:12px; padding:.75rem; }
  .sheet label{ display:block; padding:.25rem 0; }
  .sheet-actions{ display:flex; justify-content:flex-end; gap:.5rem; margin-top:1rem; }

  @media (min-width: 600px){
    .controls-grid{ grid-template-columns:1fr auto auto; align-items:center; }
    .tags{ grid-column: 1 / -1; }
  }
</style>
</head>
<body>
  <header class="site-header">
    <h1 class="hdr-title">Cognitive Rehabilitation Micro-Apps</h1>
    <button class="hdr-menu" aria-label="Open settings" aria-haspopup="dialog">⋮</button>
  </header>

  <p class="hero-sub container">
    Interactive, lightweight tools to support assessment, practice, and research in cognitive rehabilitation.
  </p>

  <div class="page">
    <main class="main container" id="appRoot">
      <section id="controls" aria-label="Search and filters">
        <div class="controls-grid">
          <div class="row">
            <input id="q" class="search" type="search" placeholder="Search apps…" autocomplete="off" />
          </div>
          <select id="sort" class="select" aria-label="Sort apps">
            <option value="az">Sort: A → Z</option>
            <option value="za">Sort: Z → A</option>
          </select>
          <button id="clear" class="btn" type="button">Clear</button>
          <div id="tagbar" class="tags" aria-label="Tags"></div>
        </div>
        <div id="count" class="count" role="status" aria-live="polite"></div>
      </section>

      <section id="cardList" aria-live="polite"></section>
    </main>
  </div>

  <!-- Settings sheet -->
  <dialog id="settingsSheet" class="sheet">
    <form method="dialog" class="sheet-body">
      <h2>Settings</h2>
      <fieldset>
        <legend>Theme</legend>
        <label><input type="radio" name="theme" value="auto"> System (auto)</label>
        <label><input type="radio" name="theme" value="light"> Light</label>
        <label><input type="radio" name="theme" value="dark"> Dark</label>
      </fieldset>
      <div class="sheet-actions">
        <button value="cancel">Close</button>
      </div>
    </form>
  </dialog>

  <script>
  // ===== Theme (no header toggle) =====
  (function(){
    const root = document.documentElement;
    const SHEET = document.getElementById('settingsSheet');
    const menuBtn = document.querySelector('.hdr-menu');
    const saved = localStorage.getItem('theme');
    if (saved && saved !== 'auto') root.setAttribute('data-theme', saved);

    menuBtn.addEventListener('click', () => {
      const current = localStorage.getItem('theme') || 'auto';
      SHEET.querySelectorAll('input[name="theme"]').forEach(r => r.checked = (r.value === current));
      SHEET.showModal();
    });
    SHEET.addEventListener('change', (e) => {
      if (e.target.name === 'theme'){
        const v = e.target.value;
        if (v === 'auto') root.removeAttribute('data-theme'); else root.setAttribute('data-theme', v);
        localStorage.setItem('theme', v);
      }
    });
  })();

  // ===== Catalog-driven rendering =====
  (async function(){
    const tagNameMap = {
      attention:"Attention", executive:"Executive",
      language:"Language", visuospatial:"Visuospatial",
      memory:"Memory", social:"Social cognition"
    };

    const catalog = await fetch('catalog.json').then(r => r.json());

    // DOM refs
    const q = document.getElementById('q');
    const sortSel = document.getElementById('sort');
    const clearBtn = document.getElementById('clear');
    const tagbar = document.getElementById('tagbar');
    const countEl = document.getElementById('count');
    const list = document.getElementById('cardList');

    // Build tag chips from catalog
    const allTags = Array.from(new Set(catalog.flatMap(a => a.tags))).sort();
    const active = new Set();
    allTags.forEach(t => {
      const b = document.createElement('button');
      b.type = 'button'; b.className = 'tag'; b.textContent = tagNameMap[t] || t;
      b.setAttribute('aria-pressed','false'); b.dataset.tag = t;
      b.addEventListener('click', () => {
        const on = b.getAttribute('aria-pressed') === 'true';
        b.setAttribute('aria-pressed', String(!on));
        !on ? active.add(t) : active.delete(t);
        render();
      });
      tagbar.appendChild(b);
    });

    clearBtn.addEventListener('click', () => {
      q.value = ''; sortSel.value = 'az'; active.clear();
      tagbar.querySelectorAll('.tag').forEach(el => el.setAttribute('aria-pressed','false'));
      render();
    });
    q.addEventListener('input', render);
    sortSel.addEventListener('change', render);

    function filterAndSort(){
      const term = q.value.trim().toLowerCase();
      let rows = catalog.filter(app => {
        const matchesText = !term || (
          app.title.toLowerCase().includes(term) ||
          app.description.toLowerCase().includes(term) ||
          app.tags.some(t => (tagNameMap[t]||t).toLowerCase().includes(term))
        );
        const matchesTags = active.size === 0 || app.tags.some(t => active.has(t));
        return matchesText && matchesTags;
      });

      rows.sort((a,b) => sortSel.value === 'az'
        ? a.title.localeCompare(b.title)
        : b.title.localeCompare(a.title)
      );
      return rows;
    }

    function render(){
      const rows = filterAndSort();
      countEl.textContent = `${rows.length} app${rows.length===1?'':'s'}`;
      list.innerHTML = '';
      rows.forEach(app => {
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <h3><a href="./${app.slug}/">${app.emoji} ${app.title}</a></h3>
          <p>${app.description}</p>
          <div class="pillrow">
            ${app.tags.map(t => `<span class="pill">${tagNameMap[t]||t}</span>`).join('')}
          </div>
        `;
        list.appendChild(card);
      });
    }

    render();
  })();
  </script>
</body>
</html>