<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Cognitive Rehabilitation Micro-Apps</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:linear-gradient(180deg,#f7f4ff 0%,#f1f9ff 42%,#ffffff 100%);
    --ink:#0f172a;
    --muted:#475569;
    --line:#e2e8f0;
    --surface:#ffffff;
    --surface-soft:rgba(255,255,255,0.65);
    --accent:#5136ff;
    --accent-alt:#ff7262;
    --radius-lg:28px;
    --radius-md:18px;
    --radius-sm:12px;
    --shadow-sm:0 12px 30px rgba(15,23,42,0.06);
    --shadow-lg:0 32px 60px rgba(15,23,42,0.12);
    --max-width:1180px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;}
  body{
    font-family:"Inter",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    background:var(--bg);
    color:var(--ink);
    letter-spacing:-0.01em;
    -webkit-font-smoothing:antialiased;
    display:flex;
    flex-direction:column;
    min-height:100vh;
  }
  a{color:inherit;text-decoration:none;}
  .muted{color:var(--muted);}
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}

  .site-header{position:relative;padding:1.75rem 1.5rem 3.0rem;}
  .site-header::before{
    content:"";position:absolute;inset:0;
    background:linear-gradient(140deg,rgba(81,54,255,0.16) 0%,rgba(162,89,255,0.12) 35%,rgba(242,78,30,0.08) 100%);
    filter:blur(65px);opacity:0.8;pointer-events:none;
  }
  .header-inner{position:relative;max-width:var(--max-width);margin:0 auto;display:flex;flex-direction:column;gap:2.2rem;}

  .top-nav{
    display:flex;align-items:center;gap:1.2rem;padding:0.85rem 1rem;border-radius:var(--radius-lg);
    background:rgba(255,255,255,0.78);backdrop-filter:blur(14px);
    border:1px solid rgba(148,163,184,0.18);box-shadow:var(--shadow-sm);
  }
  .logo{display:flex;align-items:center;gap:0.9rem;font-weight:700;font-size:1rem;letter-spacing:-0.02em;}
  .logo-mark{
    width:44px;height:44px;border-radius:16px;
    background:conic-gradient(from 140deg,#f24e1e 0%,#ff7262 30%,#a259ff 50%,#0acf83 75%,#1abcfe 100%);
    display:grid;place-items:center;color:#fff;font-weight:800;font-size:1.45rem;
    box-shadow:0 18px 35px rgba(81,54,255,0.22);
  }
  .top-links{display:flex;align-items:center;gap:1rem;margin-left:auto;font-size:0.95rem;color:var(--muted);}
  .top-links a{padding:0.45rem 0.9rem;border-radius:999px;transition:background 0.2s ease, color 0.2s ease;}
  .top-links a:hover{background:rgba(81,54,255,0.1);color:var(--ink);}
  .top-links .pill{background:var(--ink);color:#fff;font-weight:600;box-shadow:0 18px 32px rgba(15,23,42,0.25);}

  .hero{display:grid;grid-template-columns:minmax(0,1.2fr) minmax(260px,360px);gap:2.6rem;align-items:center;}
  .hero-text{display:flex;flex-direction:column;gap:1.2rem;}
  .hero-eyebrow{text-transform:uppercase;font-weight:600;letter-spacing:0.22em;font-size:0.78rem;color:var(--accent);}
  .hero h1{margin:0;font-size:clamp(2.4rem,3vw+1.8rem,3.4rem);line-height:1.06;letter-spacing:-0.03em;}
  .hero p{margin:0;font-size:1.06rem;line-height:1.65;color:color-mix(in srgb,var(--muted) 85%,white 15%);max-width:52ch;}
  .hero-actions{display:flex;flex-wrap:wrap;gap:0.75rem;}
  .cta-btn{
    display:inline-flex;align-items:center;gap:0.5rem;padding:0.75rem 1.55rem;border-radius:999px;
    font-weight:600;font-size:0.98rem;border:none;cursor:pointer;transition:transform 0.2s ease, box-shadow 0.2s ease;
  }
  .cta-btn.primary{background:linear-gradient(135deg,#5136ff 0%,#a259ff 100%);color:#fff;box-shadow:0 22px 40px rgba(81,54,255,0.35);}
  .cta-btn.secondary{background:var(--surface-soft);border:1px solid rgba(148,163,184,0.35);color:var(--ink);backdrop-filter:blur(12px);}

  .hero-preview{
    position:relative;padding:1.8rem;border-radius:var(--radius-lg);background:var(--surface);
    overflow:hidden;border:1px solid rgba(148,163,184,0.22);box-shadow:var(--shadow-lg);display:flex;flex-direction:column;gap:1rem;
  }
  .hero-preview::before{
    content:"";position:absolute;inset:-40% -20% 30% -40%;
    background:var(--card-gradient,linear-gradient(135deg,#d8e9ff 0%,#f7e9ff 100%));
    opacity:0.9;filter:blur(16px);z-index:0;
  }
  .hero-preview-content{position:relative;z-index:1;}
  .hero-preview h3{margin:0 0 .25rem 0}

  main{flex:1;max-width:var(--max-width);margin:0 auto;padding:0 1.5rem 4rem;}
  .section{margin-top:3.0rem;display:flex;flex-direction:column;gap:1.6rem;}
  .section-heading{display:flex;flex-wrap:wrap;align-items:flex-end;gap:1.2rem;justify-content:space-between;}
  .section-heading h2{margin:0;font-size:clamp(1.9rem,2vw+1.6rem,2.4rem);letter-spacing:-0.02em;}
  .section-heading p{margin:0;font-size:1rem;line-height:1.6;color:var(--muted);max-width:52ch;}

  .control-bar{width:100%;display:flex;flex-wrap:wrap;gap:1rem;align-items:center;}
  .search-field{flex:1 1 260px;position:relative;}
  .search-field input{
    width:100%;padding:0.75rem 1.2rem 0.75rem 2.7rem;border-radius:999px;border:1px solid rgba(148,163,184,0.32);
    background:rgba(255,255,255,0.92);font-size:0.95rem;color:var(--ink);box-shadow:0 15px 25px rgba(15,23,42,0.07);
    transition:border 0.2s ease, box-shadow 0.2s ease;
  }
  .search-field input:focus{outline:none;border-color:var(--accent);box-shadow:0 18px 40px rgba(81,54,255,0.25);}
  .search-field svg{position:absolute;left:1rem;top:50%;transform:translateY(-50%);width:18px;height:18px;color:var(--muted);}
  .tag-strip{flex:1 1 100%;display:flex;gap:0.6rem;overflow-x:auto;padding:0.3rem 0;scroll-snap-type:x mandatory;}
  .tag-pill{
    flex:0 0 auto;display:inline-flex;align-items:center;gap:0.35rem;padding:0.5rem 1.05rem;border-radius:999px;border:1px solid transparent;
    background:rgba(148,163,184,0.18);color:var(--muted);font-size:0.85rem;font-weight:600;cursor:pointer;white-space:nowrap;scroll-snap-align:start;
    transition:transform 0.2s ease, background 0.2s ease, border 0.2s ease, color 0.2s ease;
  }
  .tag-pill[data-active="true"]{
    background:linear-gradient(135deg,rgba(81,54,255,0.18) 0%,rgba(162,89,255,0.24) 100%);
    color:var(--ink);border-color:rgba(81,54,255,0.4);box-shadow:0 16px 30px rgba(81,54,255,0.18);
  }

  /* ===== Carousel (3D) ===== */
  .carousel{position:relative;display:flex;align-items:center;justify-content:center;gap:1.5rem;width:100%;margin-top:1rem;}
  .carousel[data-empty="true"]{display:none;}
  .carousel-viewport{position:relative;width:100%;max-width:var(--max-width);height:440px;perspective:1600px;overflow:visible;}
  .carousel-track{
    position:absolute;inset:0;transform-style:preserve-3d;
    transition:transform 0.75s cubic-bezier(.22,.61,.36,1);will-change:transform;
  }
  .carousel-item{
    position:absolute;top:50%;left:50%;width:min(340px,72vw);transform-style:preserve-3d;
    transition:transform 0.75s cubic-bezier(.22,.61,.36,1), filter 0.45s ease, opacity 0.45s ease;
    opacity:0.55;filter:blur(.3px);transform:translate(-50%,-50%);
  }
  .carousel-item.is-active{opacity:1;filter:none;}
  .carousel-item .card{min-height:320px;}

  .carousel-nav{
    flex:0 0 auto;width:52px;height:52px;border-radius:50%;
    border:1px solid rgba(148,163,184,0.35);background:rgba(255,255,255,0.85);
    backdrop-filter:blur(10px);color:var(--ink);display:grid;place-items:center;cursor:pointer;
    box-shadow:0 18px 32px rgba(15,23,42,0.12);transition:transform 0.2s ease, box-shadow 0.2s ease, border 0.2s ease;
  }
  .carousel-nav:disabled{opacity:0.45;cursor:not-allowed;box-shadow:none;transform:none;}
  .carousel-nav svg{width:18px;height:18px;}
  .carousel-pagination{
    position:absolute;bottom:1rem;left:50%;transform:translateX(-50%);
    display:flex;gap:0.6rem;padding:0.35rem 0.75rem;border-radius:999px;background:rgba(255,255,255,0.78);
    border:1px solid rgba(148,163,184,0.18);backdrop-filter:blur(12px);box-shadow:0 12px 28px rgba(15,23,42,0.12);
  }
  .carousel-dot{width:11px;height:11px;border-radius:999px;border:none;background:rgba(148,163,184,0.45);padding:0;cursor:pointer;transition:width 0.25s ease, background 0.25s ease;}
  .carousel-dot[data-active="true"]{width:28px;background:linear-gradient(135deg,#5136ff 0%,#a259ff 100%);}

  .card{
    position:relative;border-radius:var(--radius-lg);padding:1.6rem 1.7rem 1.8rem;
    border:1px solid rgba(148,163,184,0.18);background:var(--surface);overflow:hidden;
    transition:transform 0.25s cubic-bezier(.16,1,.3,1), box-shadow 0.25s ease;
  }
  .card::before{
    content:"";position:absolute;inset:-30% -20% 45% -30%;
    background:var(--card-gradient,linear-gradient(135deg,#e4f1ff 0%,#f6e8ff 100%));
    opacity:0.9;filter:blur(20px);z-index:0;transition:transform 0.25s ease;
  }
  .card-link{position:relative;z-index:1;display:flex;flex-direction:column;gap:1.15rem;height:100%;}
  .card-header{display:flex;align-items:center;gap:0.6rem;}
  .card-emoji{font-size:2.1rem;}
  .chip{
    padding:0.3rem 0.7rem;border-radius:999px;font-size:0.72rem;letter-spacing:0.14em;
    text-transform:uppercase;font-weight:700;background:rgba(15,23,42,0.08);color:var(--ink);
  }
  .card h3{margin:0;font-size:1.28rem;letter-spacing:-0.01em;}
  .card p{margin:0;font-size:0.95rem;line-height:1.55;color:var(--muted);}
  .tag-list{display:flex;flex-wrap:wrap;gap:0.45rem;margin-top:auto;}
  .tag-list span{
    padding:0.38rem 0.75rem;border-radius:999px;font-size:0.78rem;font-weight:600;
    background:rgba(255,255,255,0.75);border:1px solid rgba(148,163,184,0.28);color:var(--muted);
  }

  .empty-state{
    padding:2.4rem;border-radius:var(--radius-md);border:1px dashed rgba(148,163,184,0.35);
    background:rgba(255,255,255,0.85);text-align:center;font-size:1rem;color:var(--muted);
  }

  .featured-wrap{display:flex;flex-direction:column;gap:1.5rem;}
  #featuredGrid{display:flex;gap:1.4rem;overflow-x:auto;padding-bottom:0.4rem;margin-bottom:-0.4rem;scroll-snap-type:x mandatory;}
  #featuredGrid .card{min-width:280px;flex:0 0 auto;scroll-snap-align:start;}
  #featuredGrid .card::before{inset:-20% -10% 50% -20%;}
  .card.card--featured .chip{background:rgba(81,54,255,0.16);color:var(--ink);}

  .site-footer{
    margin-top:auto;padding:2.5rem 1.5rem;
    background:linear-gradient(180deg,rgba(248,249,255,0.9) 0%,rgba(239,246,255,0.95) 60%,#ffffff 100%);
    border-top:1px solid rgba(226,232,240,0.9);text-align:center;color:var(--muted);font-size:0.96rem;
  }
  .site-footer a{color:var(--accent-alt);} 
  .site-footer a:hover{text-decoration:underline;}

  @media(max-width:1080px){ .carousel-viewport{height:400px;} }
  @media(max-width:960px){
    .hero{grid-template-columns:minmax(0,1fr);}
    .hero-preview{order:-1;max-width:420px;justify-self:center;}
    .carousel-nav{display:none;}
  }
  /* Keep 3D on mobile (override typical 2D fallback) */
  @media(max-width:720px){
    .site-header{padding:1.25rem 1rem 2.2rem;}
    .header-inner{gap:2rem;}
    .top-nav{flex-wrap:wrap;gap:0.75rem;padding:0.75rem 0.85rem;}
    .top-links{width:100%;justify-content:flex-start;flex-wrap:wrap;gap:0.65rem;}
    .hero-actions{width:100%;}
    .cta-btn{flex:1 1 auto;justify-content:center;}
    main{padding:0 1rem 3rem;}
    .carousel{flex-direction:column;align-items:stretch;gap:1rem;}
    .carousel-viewport{height:420px;perspective:1100px;overflow:visible;}
    .carousel-item{width:82vw;max-width:360px;margin:0 auto;}
    .carousel-pagination{position:absolute;left:50%;transform:translateX(-50%);bottom:.6rem;margin:0;}
  }
  /* Reduced motion accessibility: 2D scroll-snap fallback */
  @media (prefers-reduced-motion: reduce){
    .carousel-viewport{perspective:none;height:auto}
    .carousel-track{position:static;display:flex;gap:1rem;overflow-x:auto;padding-bottom:.75rem;margin:0 -0.5rem;scroll-snap-type:x mandatory;transform:none !important}
    .carousel-item{position:relative;top:auto;left:auto;flex:0 0 85%;max-width:320px;margin:0 auto;opacity:1;filter:none;transform:none !important;scroll-snap-align:center}
    .carousel-pagination{position:static;transform:none;margin:0 auto}
    .carousel-nav{display:none}
  }
</style>
</head>
<body>
<header class="site-header">
  <div class="header-inner">
    <nav class="top-nav" aria-label="Primary">
      <a class="logo" href="#grid"><span class="logo-mark" aria-hidden="true">Âµ</span> Cognitive Rehab Lab</a>
      <div class="top-links">
        <a href="#grid">Browse library</a>
        <a href="#featured">Featured</a>
        <a href="https://github.com/marcomion/micro-apps" target="_blank" rel="noopener">GitHub</a>
        <a class="pill" href="mailto:m.mion@nhs.net">Partner with us</a>
      </div>
    </nav>

    <div class="hero">
      <div class="hero-text">
        <span class="hero-eyebrow">Micro-app experiences</span>
        <h1>Design-forward clinical tools for cognitive rehabilitation teams.</h1>
        <p>Explore a vibrant index of lightweight applications inspired by the craft of product design. Curated to support assessment, therapy practice, and collaborative research in minutes, not months.</p>
        <div class="hero-actions">
          <a class="cta-btn primary" href="#grid">Browse the collection</a>
          <a class="cta-btn secondary" href="mailto:m.mion@nhs.net">Discuss a project</a>
        </div>
        <dl class="stat-board" aria-live="polite">
          <div class="stat"><dt id="statApps">0</dt><dd>Micro-apps available</dd></div>
          <div class="stat"><dt id="statTags">0</dt><dd>Clinical focus areas</dd></div>
          <div class="stat"><dt id="statFeatured">0</dt><dd>Curated editorâ€™s picks</dd></div>
        </dl>
      </div>
      <aside class="hero-preview" id="heroPreview" aria-hidden="true">
        <div class="hero-preview-content">
          <span class="hero-preview-emoji" aria-hidden="true">âœ¨</span>
          <h3>Loading the labâ€¦</h3>
          <p>We craft immersive micro-experiences that look and feel as polished as your favourite design tools.</p>
          <div class="tag-list"></div>
        </div>
      </aside>
    </div>
  </div>
</header>

<main>
  <section class="section" id="grid">
    <div class="section-heading">
      <div>
        <h2>Explore focused experiences for cognitive rehabilitation</h2>
        <p>Swipe/drag to rotate the 3D carousel on mobile. Tap a card to open an app.</p>
      </div>
    </div>

    <div class="control-bar">
      <label class="search-field">
        <span class="sr-only">Search micro-apps</span>
        <svg aria-hidden="true" viewBox="0 0 24 24" fill="none"><path d="m21 21-4.8-4.8m2.3-5.5a7.8 7.8 0 1 1-15.6 0 7.8 7.8 0 0 1 15.6 0Z" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
        <input type="search" id="search" placeholder="Search by name or description" autocomplete="off" spellcheck="false">
      </label>
      <div class="tag-strip" id="tagCloud" aria-live="polite"></div>
    </div>

    <div class="carousel" id="carousel" tabindex="0">
      <button class="carousel-nav" type="button" id="carouselPrev" aria-label="Show previous micro-app">
        <svg aria-hidden="true" viewBox="0 0 24 24" fill="none"><path d="M15.5 5.5 9 12l6.5 6.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
      <div class="carousel-viewport" id="carouselViewport">
        <div class="carousel-track" id="appCarousel" role="list"></div>
        <div class="carousel-pagination" id="carouselPagination" role="tablist" aria-label="Select highlighted micro-app"></div>
      </div>
      <button class="carousel-nav" type="button" id="carouselNext" aria-label="Show next micro-app">
        <svg aria-hidden="true" viewBox="0 0 24 24" fill="none"><path d="M8.5 5.5 15 12l-6.5 6.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
    </div>
    <div class="empty-state" id="emptyState" hidden>No micro-apps match your filters just yet. Clear filters to browse the full collection.</div>
  </section>

  <section class="section" id="featured">
    <div class="section-heading">
      <div>
        <h2>Start with popular experiences that spark engagement</h2>
        <p>A rotating set of featured micro-apps that clinicians rate highly for their impact, clarity, and delight.</p>
      </div>
    </div>
    <div class="featured-wrap">
      <div id="featuredGrid" aria-live="polite"></div>
    </div>
  </section>
</main>

<footer class="site-footer">
  <p>Â© 2025 Cognitive Rehabilitation Micro-Apps â€” Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener">Apache 2.0 License</a>.</p>
  <p>Contact: <a href="mailto:m.mion@nhs.net">m.mion@nhs.net</a> Â· <a href="https://www.linkedin.com/in/marco-mion/" target="_blank" rel="noopener">LinkedIn</a></p>
  <p id="last-updated" class="muted"></p>
</footer>

<script>
  // Minimal data to render out of the box; replace with your real data wire-up.
  const fallbackApps = [
    { slug:"market-manager", emoji:"ðŸ›’", title:"Market Manager", desc:"Working memory under retail pressure.", href:"#", tags:["executive","memory"] },
    { slug:"cashpoint-coach", emoji:"ðŸ§", title:"CashPoint Coach", desc:"ATM practice with spoken steps.", href:"#", tags:["planning","everyday"] },
    { slug:"task-juggler", emoji:"ðŸ§ ", title:"Task Juggler", desc:"Multitask with timed interruptions.", href:"#", tags:["executive"] },
    { slug:"emergency-call-simulator", emoji:"ðŸ“ž", title:"Emergency Call Simulator", desc:"Practise structured calls under stress.", href:"#", tags:["attention"] },
    { slug:"fluency-coach", emoji:"ðŸ’¬", title:"Fluency Coach", desc:"Strategy-led verbal fluency.", href:"#", tags:["language"] },
    { slug:"barista-chaos", emoji:"â˜•", title:"Barista Chaos", desc:"Dual-tasking with orders & timing.", href:"#", tags:["dual-task"] },
    { slug:"maze-explorer", emoji:"ðŸ§­", title:"Maze Explorer", desc:"Visuospatial scanning & planning.", href:"#", tags:["visuospatial"] },
    { slug:"plan-with-coco", emoji:"ðŸ¦", title:"Plan with Coco", desc:"Prospective memory & routines.", href:"#", tags:["planning"] }
  ];

  const state = {
    apps: [],          // set yours here; we fall back if empty
    activeTag: 'all',
    search: '',
    currentIndex: 0,
    filtered: [],
    radius: 0,
    step: 0
  };

  const gradientPalette = [
    'linear-gradient(135deg,#e4f1ff 0%,#f6e8ff 100%)',
    'linear-gradient(135deg,#ffe6f2 0%,#f9ecff 100%)',
    'linear-gradient(135deg,#e0fdf4 0%,#e9f4ff 100%)',
    'linear-gradient(135deg,#fff1e6 0%,#fbe9ff 100%)',
    'linear-gradient(135deg,#f7f3ff 0%,#e7f4ff 100%)'
  ];

  const $ = (id) => document.getElementById(id);
  const carousel = $('carousel');
  const carouselTrack = $('appCarousel');
  const carouselViewport = $('carouselViewport');
  const carouselDots = $('carouselPagination');
  const btnPrev = $('carouselPrev');
  const btnNext = $('carouselNext');
  const emptyState = $('emptyState');
  const statApps = $('statApps');
  const statTags = $('statTags');
  const statFeatured = $('statFeatured');
  const featuredGrid = $('featuredGrid');

  function initData(){
    // Use provided apps if any; else fallback
    if (!Array.isArray(state.apps) || state.apps.length === 0) state.apps = fallbackApps;
    state.filtered = state.apps.slice();
    updateStats();
  }

  function updateStats(){
    const tagSet = new Set(state.apps.flatMap(a => a.tags || []));
    statApps.textContent = state.apps.length;
    statTags.textContent = tagSet.size;
    statFeatured.textContent = Math.min(4, state.apps.length);
  }

  function renderCarousel(){
    if (!state.filtered.length){
      carousel.setAttribute('data-empty','true');
      emptyState.hidden = false;
      return;
    }
    carousel.removeAttribute('data-empty');
    emptyState.hidden = true;

    carouselTrack.innerHTML = '';
    carouselDots.innerHTML = '';
    state.filtered.forEach((app, i) => {
      const item = document.createElement('div');
      item.className = 'carousel-item';
      item.setAttribute('role','listitem');
      item.innerHTML = `
        <article class="card" style="--card-gradient:${gradientPalette[i % gradientPalette.length]}">
          <a class="card-link" href="${app.href || '#'}">
            <header class="card-header">
              <span class="card-emoji" aria-hidden="true">${app.emoji || 'ðŸ§©'}</span>
              <span class="chip">App</span>
            </header>
            <h3>${app.title || app.slug}</h3>
            <p>${app.desc || ''}</p>
            <div class="tag-list">${(app.tags||[]).map(t=>`<span>${t}</span>`).join('')}</div>
          </a>
        </article>`;
      carouselTrack.appendChild(item);

      const dot = document.createElement('button');
      dot.className = 'carousel-dot';
      dot.type = 'button';
      dot.setAttribute('role','tab');
      dot.setAttribute('aria-label',`Slide ${i+1}`);
      dot.addEventListener('click', () => goTo(i));
      carouselDots.appendChild(dot);
    });

    layoutRing();
    updateActive();
  }

  function renderFeatured(){
    featuredGrid.innerHTML = '';
    state.apps.slice(0,4).forEach((app, i) => {
      const card = document.createElement('article');
      card.className = 'card card--featured';
      card.style.setProperty('--card-gradient', gradientPalette[i % gradientPalette.length]);
      card.innerHTML = `
        <a class="card-link" href="${app.href || '#'}">
          <header class="card-header">
            <span class="card-emoji" aria-hidden="true">${app.emoji || 'ðŸ§©'}</span>
            <span class="chip">Featured</span>
          </header>
          <h3>${app.title || app.slug}</h3>
          <p>${app.desc || ''}</p>
          <div class="tag-list">${(app.tags||[]).map(t=>`<span>${t}</span>`).join('')}</div>
        </a>`;
      featuredGrid.appendChild(card);
    });
  }

  function layoutRing(){
    const items = Array.from(carouselTrack.children);
    if (!items.length) return;
    const w = Math.min(items[0].getBoundingClientRect().width || 320, 360);
    const gap = 24;
    state.step = 360 / items.length;
    state.radius = Math.round((items.length * (w + gap)) / (2 * Math.PI));

    items.forEach((el, i) => {
      const angle = i * state.step;
      el.style.transform = `translate(-50%, -50%) rotateY(${angle}deg) translateZ(${state.radius}px)`;
      el.style.willChange = 'transform';
    });
    applyRotation(true);
  }

  function applyRotation(instant){
    carouselTrack.style.transition = instant ? 'none' : 'transform 0.75s cubic-bezier(.22,.61,.36,1)';
    carouselTrack.style.transform = `translateZ(-${state.radius}px) rotateY(${-state.currentIndex * state.step}deg)`;
  }

  function updateActive(){
    const items = Array.from(carouselTrack.children);
    const dots = Array.from(carouselDots.children);
    items.forEach((el, i) => el.classList.toggle('is-active', i === state.currentIndex));
    dots.forEach((d, i) => d.dataset.active = i === state.currentIndex ? 'true' : 'false');
  }

  function goTo(i){
    const n = state.filtered.length;
    state.currentIndex = ((i % n) + n) % n;
    applyRotation(false);
    updateActive();
  }
  const next = () => goTo(state.currentIndex + 1);
  const prev = () => goTo(state.currentIndex - 1);

  // Swipe / drag controls
  let swipeStartX = 0, swipeStartTime = 0, dragging = false;
  carouselViewport.addEventListener('pointerdown', e => { dragging = true; swipeStartX = e.clientX; swipeStartTime = performance.now(); carouselViewport.setPointerCapture?.(e.pointerId); carouselTrack.style.transition='none'; });
  carouselViewport.addEventListener('pointermove', e => {
    if (!dragging) return;
    const dx = e.clientX - swipeStartX;
    const anglePerPx = 180 / (Math.PI * state.radius * 0.9);
    const angle = (-state.currentIndex * state.step) + (dx * anglePerPx);
    carouselTrack.style.transform = `translateZ(-${state.radius}px) rotateY(${angle}deg)`;
    e.preventDefault();
  }, {passive:false});
  carouselViewport.addEventListener('pointerup', e => {
    if (!dragging) return;
    dragging = false;
    const dx = e.clientX - swipeStartX;
    const dt = Math.max(1, performance.now() - swipeStartTime);
    const velocity = Math.abs(dx) / dt;
    if (Math.abs(dx) > 30 || velocity > 0.6){ dx < 0 ? next() : prev(); } else { applyRotation(false); updateActive(); }
  });

  // iOS touch support
  carouselViewport.addEventListener('touchstart', e => { swipeStartX = e.touches[0].clientX; swipeStartTime = performance.now(); }, {passive:true});
  carouselViewport.addEventListener('touchmove', e => { if (dragging) e.preventDefault(); }, {passive:false});
  carouselViewport.addEventListener('touchend', e => {
    const endX = (e.changedTouches && e.changedTouches[0].clientX) || swipeStartX;
    const dx = endX - swipeStartX;
    const dt = Math.max(1, performance.now() - swipeStartTime);
    const velocity = Math.abs(dx) / dt;
    if (Math.abs(dx) > 30 || velocity > 0.6){ dx < 0 ? next() : prev(); } else { applyRotation(false); updateActive(); }
    dragging = false;
  });

  // Buttons & keyboard
  btnPrev?.addEventListener('click', prev);
  btnNext?.addEventListener('click', next);
  carousel.addEventListener('keydown', (e) => { if (e.key === 'ArrowRight') next(); if (e.key === 'ArrowLeft') prev(); });

  // MutationObserver to re-layout if you rebuild slides dynamically
  new MutationObserver(() => { layoutRing(); updateActive(); }).observe(carouselTrack, { childList:true });

  // Simple search filter (optional)
  $('search').addEventListener('input', (e) => {
    const q = e.target.value.toLowerCase().trim();
    state.filtered = state.apps.filter(a => (a.title||'').toLowerCase().includes(q) || (a.desc||'').toLowerCase().includes(q));
    state.currentIndex = 0;
    renderCarousel();
  });

  // Init
  (function init(){
    initData();
    renderCarousel();
    renderFeatured();
    $('last-updated').textContent = 'Last updated: ' + new Date().toLocaleString();
  })();
</script>
</body>
</html>
