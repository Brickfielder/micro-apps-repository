<!DOCTYPE html><html lang="en"> 
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cognitive Rehabilitation Micro-Apps — 3D Mobile Carousel</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:linear-gradient(180deg,#f7f4ff 0%,#f1f9ff 42%,#ffffff 100%);
    --ink:#0f172a; --muted:#475569; --line:#e2e8f0; --surface:#ffffff;
    --surface-soft:rgba(255,255,255,0.65); --accent:#5136ff; --accent-alt:#ff7262;
    --radius-lg:28px; --radius-md:18px; --radius-sm:12px;
    --shadow-sm:0 12px 30px rgba(15,23,42,0.06); --shadow-lg:0 32px 60px rgba(15,23,42,0.12);
    --max-width:1180px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%}
  body{
    font-family:"Inter",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    background:var(--bg); color:var(--ink); -webkit-font-smoothing:antialiased;
    letter-spacing:-0.01em; display:flex; flex-direction:column; min-height:100vh;
  }
  a{color:inherit;text-decoration:none}
  .muted{color:var(--muted)}
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

  /* Header / hero */
  .site-header{position:relative;padding:1.75rem 1.5rem 2rem}
  .site-header::before{content:"";position:absolute;inset:0;background:linear-gradient(140deg,rgba(81,54,255,.16) 0%,rgba(162,89,255,.12) 35%,rgba(242,78,30,.08) 100%);filter:blur(65px);opacity:.8;pointer-events:none}
  .header-inner{position:relative;max-width:var(--max-width);margin:0 auto;display:flex;flex-direction:column;gap:2rem}
  .top-nav{display:flex;align-items:center;gap:1.2rem;padding:.85rem 1rem;border-radius:var(--radius-lg);background:rgba(255,255,255,.78);backdrop-filter:blur(14px);border:1px solid rgba(148,163,184,.18);box-shadow:var(--shadow-sm)}
  .logo{display:flex;align-items:center;gap:.9rem;font-weight:700;font-size:1rem;letter-spacing:-.02em}
  .logo-mark{width:44px;height:44px;border-radius:16px;background:conic-gradient(from 140deg,#f24e1e 0%,#ff7262 30%,#a259ff 50%,#0acf83 75%,#1abcfe 100%);display:grid;place-items:center;color:#fff;font-weight:800;font-size:1.45rem;box-shadow:0 18px 35px rgba(81,54,255,.22)}
  .top-links{display:flex;align-items:center;gap:1rem;margin-left:auto;font-size:.95rem;color:var(--muted)}
  .top-links a{padding:.45rem .9rem;border-radius:999px;transition:background .2s ease,color .2s ease}
  .top-links a:hover{background:rgba(81,54,255,.1);color:var(--ink)}
  .top-links .pill{background:var(--ink);color:#fff;font-weight:600;box-shadow:0 18px 32px rgba(15,23,42,.25)}

  .hero{display:grid;grid-template-columns:minmax(0,1.2fr) minmax(260px,360px);gap:2.25rem;align-items:center}
  .hero h1{margin:0;font-size:clamp(2.2rem,3vw+1.6rem,3.2rem);line-height:1.08;letter-spacing:-.03em}
  .hero p{margin:0;font-size:1.05rem;line-height:1.65;color:color-mix(in srgb,var(--muted) 85%,white 15%);max-width:52ch}
  .hero-actions{display:flex;flex-wrap:wrap;gap:.75rem}
  .cta-btn{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1.55rem;border-radius:999px;font-weight:600;font-size:.98rem;border:none;cursor:pointer;transition:transform .2s ease,box-shadow .2s ease}
  .cta-btn.primary{background:linear-gradient(135deg,#5136ff 0%,#a259ff 100%);color:#fff;box-shadow:0 22px 40px rgba(81,54,255,.35)}
  .hero-preview{position:relative;padding:1.6rem;border-radius:var(--radius-lg);background:var(--surface);overflow:hidden;border:1px solid rgba(148,163,184,.22);box-shadow:var(--shadow-lg)}
  .hero-preview::before{content:"";position:absolute;inset:-40% -20% 30% -40%;background:linear-gradient(135deg,#d8e9ff 0%,#f7e9ff 100%);opacity:.9;filter:blur(16px);z-index:0}
  .hero-preview-content{position:relative;z-index:1}

  main{flex:1;max-width:var(--max-width);margin:0 auto;padding:0 1.5rem 3rem}
  .section{margin-top:2.8rem;display:flex;flex-direction:column;gap:1.4rem}
  .section-heading h2{margin:0;font-size:clamp(1.8rem,2vw+1.2rem,2.3rem);letter-spacing:-.02em}

  /* 3D Carousel */
  .carousel{position:relative;display:flex;align-items:center;justify-content:center;gap:1rem;width:min(100%,960px);margin:.5rem auto 0}
  .carousel-viewport{position:relative;width:100%;max-width:var(--max-width);height:430px;perspective:1400px;overflow:visible;touch-action:pan-y}
  .carousel-track{position:absolute;inset:0;transform-style:preserve-3d;transition:transform .75s cubic-bezier(.22,.61,.36,1);will-change:transform}
  .carousel-item{
    position:absolute;top:50%;left:50%;width:min(320px,72vw);
    transform-style:preserve-3d;transition:transform .75s cubic-bezier(.22,.61,.36,1),filter .45s ease,opacity .45s ease;
    opacity:.55;filter:blur(.3px); pointer-events:none; /* only active clickable */
  }
  .carousel-item.is-active{opacity:1;filter:none;pointer-events:auto;z-index:3}
  .carousel-item .card{min-height:320px}

  .card{position:relative;border-radius:var(--radius-lg);padding:1.4rem 1.5rem 1.6rem;border:1px solid rgba(148,163,184,.18);background:var(--surface);overflow:hidden;box-shadow:var(--shadow-sm)}
  .card::before{content:"";position:absolute;inset:-30% -20% 45% -30%;background:var(--card-gradient,linear-gradient(135deg,#e4f1ff 0%,#f6e8ff 100%));opacity:.9;filter:blur(20px);z-index:0}
  .card-link{position:relative;z-index:1;display:block;height:100%;-webkit-transform:translateZ(0);transform:translateZ(0)}
  .card-header{display:flex;align-items:center;gap:.6rem}
  .card-emoji{font-size:2rem}
  .chip{display:inline-flex;align-items:center;gap:.25rem;padding:.32rem .65rem;border-radius:999px;font-size:.72rem;font-weight:600;letter-spacing:.02em;background:rgba(15,23,42,.08);color:var(--muted);border:1px solid rgba(148,163,184,.22)}
  .card h3{margin:0;font-size:1.2rem;letter-spacing:-.01em}
  .card p{margin:0;font-size:.96rem;line-height:1.55;color:var(--muted)}
  .tag-list{display:flex;flex-wrap:wrap;gap:.45rem;margin-top:auto}
  .tag-list span{padding:.38rem .75rem;border-radius:999px;font-size:.78rem;font-weight:600;background:rgba(255,255,255,.75);border:1px solid rgba(148,163,184,.28);color:var(--muted)}

  .featured-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1.4rem;margin-top:.5rem}
  .featured-card{position:relative;display:flex;flex-direction:column;gap:.8rem;padding:1.2rem 1.4rem;border-radius:var(--radius-md);border:1px solid rgba(148,163,184,.2);background:rgba(255,255,255,.9);box-shadow:var(--shadow-sm)}
  .featured-card h3{margin:0;font-size:1.05rem}
  .featured-card p{margin:0;font-size:.92rem;line-height:1.55;color:var(--muted)}
  .featured-card .tag-list{margin-top:0}

  .carousel-nav{flex:0 0 auto;width:46px;height:46px;border-radius:50%;border:1px solid rgba(148,163,184,.35);background:rgba(255,255,255,.85);backdrop-filter:blur(10px);color:var(--ink);display:grid;place-items:center;cursor:pointer;box-shadow:0 18px 32px rgba(15,23,42,.12);transition:transform .2s ease,box-shadow .2s ease,border .2s ease}
  .carousel-nav:disabled{opacity:.45;cursor:not-allowed;box-shadow:none;transform:none}
  .carousel-nav svg{width:18px;height:18px}

  .carousel-pagination{position:absolute;bottom:.6rem;left:50%;transform:translateX(-50%);display:flex;gap:.5rem;padding:.35rem .7rem;border-radius:999px;background:rgba(255,255,255,.78);border:1px solid rgba(148,163,184,.18);backdrop-filter:blur(12px);box-shadow:0 12px 28px rgba(15,23,42,.12)}
  .carousel-dot{width:10px;height:10px;border-radius:999px;border:none;background:rgba(148,163,184,.45);padding:0;cursor:pointer;transition:width .25s ease, background .25s ease}
  .carousel-dot[data-active="true"]{width:26px;background:linear-gradient(135deg,#5136ff 0%,#a259ff 100%)}

  @media (max-width: 720px){
    .carousel{width:100%;}
    .site-header{padding:1.25rem 1rem 1.6rem}
    main{padding:0 1rem 2.4rem}
    .carousel-viewport{height:420px;perspective:1100px}
    .carousel-item{width:82vw}
  }

  @media (prefers-reduced-motion: reduce){
    .carousel-viewport{perspective:none;height:auto}
    .carousel-track{position:static;display:flex;gap:1rem;overflow-x:auto;padding-bottom:.75rem;margin:0 -0.5rem;scroll-snap-type:x mandatory;transform:none !important}
    .carousel-item{position:relative;top:auto;left:auto;flex:0 0 85%;max-width:320px;margin:0 auto;opacity:1;filter:none;transform:none !important;scroll-snap-align:center;pointer-events:auto}
    .carousel-pagination{position:static;transform:none;margin:0 auto}
    .carousel-nav{display:none}
  }
</style>
</head>
<body>
<header class="site-header">
  <div class="header-inner">
    <nav class="top-nav" aria-label="Primary">
      <a class="logo" href="#grid"><span class="logo-mark" aria-hidden="true">µ</span> Cognitive Rehab Lab</a>
      <div class="top-links">
        <a href="#grid">Browse library</a>
        <a href="#featured">Featured</a>
        <a href="https://github.com/marcomion/micro-apps" target="_blank" rel="noopener">GitHub</a>
        <a class="pill" href="mailto:m.mion@nhs.net">Partner with us</a>
      </div>
    </nav>
    <div class="hero">
      <div>
        <h1>Design-forward clinical tools for cognitive rehabilitation teams.</h1>
        <p>Explore a vibrant index of lightweight applications inspired by product design. Curated to support assessment, therapy, and research in minutes, not months.</p>
        <div class="hero-actions">
          <a class="cta-btn primary" href="#grid">Browse the collection</a>
        </div>
      </div>
      <aside class="hero-preview" aria-hidden="true">
        <div class="hero-preview-content">
          <span style="font-size:2.2rem">✨</span>
          <h3 style="margin:.2rem 0 0">Loading the lab…</h3>
          <p class="muted" style="margin:.4rem 0 0">Immersive micro-experiences that feel as polished as your favourite design tools.</p>
        </div>
      </aside>
    </div>
  </div>
</header>

<main>
  <section class="section" id="grid">
    <div class="section-heading">
      <div>
        <h2>Explore focused experiences for cognitive rehabilitation</h2>
        <p class="muted">Swipe/drag to rotate the 3D carousel on mobile. Tap a card to open an app.</p>
      </div>
    </div>

    <div class="carousel" id="carousel" tabindex="0" aria-roledescription="carousel" aria-label="Micro-apps carousel">
      <button class="carousel-nav" type="button" id="carouselPrev" aria-label="Show previous micro-app">
        <svg aria-hidden="true" viewBox="0 0 24 24" fill="none"><path d="M15.5 5.5 9 12l6.5 6.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
      <div class="carousel-viewport" id="carouselViewport">
        <div class="carousel-track" id="appCarousel" role="list"></div>
        <div class="carousel-pagination" id="carouselPagination" role="tablist" aria-label="Select highlighted micro-app"></div>
      </div>
      <button class="carousel-nav" type="button" id="carouselNext" aria-label="Show next micro-app">
        <svg aria-hidden="true" viewBox="0 0 24 24" fill="none"><path d="M8.5 5.5 15 12l-6.5 6.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
    </div>
  </section>

  <section class="section" id="featured">
    <div class="section-heading">
      <div>
        <h2>Start with popular experiences that spark engagement</h2>
        <p class="muted">A rotating set of featured micro-apps.</p>
      </div>
    </div>
    <div id="featuredGrid"></div>
  </section>
</main>

<footer class="site-footer" style="text-align:center;padding:2rem 1rem;color:var(--muted)">
  <p>© 2025 Cognitive Rehabilitation Micro-Apps — Apache 2.0</p>
  <p id="last-updated" class="muted"></p>
</footer>

<script>
(() => {
  const state = {
    apps: [],
    currentIndex: 0,
    step: 0,
    radius: 0,
    pointerDown: false,
    isDragging: false,
    dragStartX: 0,
    dragStartY: 0,
    baseRotation: 0,
    swipeStartTime: 0,
    moved: 0,
    ignoreClick: false
  };

  const gradientPalette = [
    'linear-gradient(135deg,#e4f1ff 0%,#f6e8ff 100%)',
    'linear-gradient(135deg,#ffe6f2 0%,#f9ecff 100%)',
    'linear-gradient(135deg,#e0fdf4 0%,#e9f4ff 100%)',
    'linear-gradient(135deg,#fff1e6 0%,#fbe9ff 100%)',
    'linear-gradient(135deg,#f7f3ff 0%,#e7f4ff 100%)'
  ];

  const track = document.getElementById('appCarousel');
  const pagination = document.getElementById('carouselPagination');
  const viewport = document.getElementById('carouselViewport');
  const btnPrev = document.getElementById('carouselPrev');
  const btnNext = document.getElementById('carouselNext');

  function render() {
    if (!state.apps.length) return;
    track.innerHTML = '';
    pagination.innerHTML = '';

    state.apps.forEach((app, i) => {
      const item = document.createElement('div');
      item.className = 'carousel-item';
      item.setAttribute('role', 'listitem');
      item.innerHTML = `
        <article class="card" style="--card-gradient:${gradientPalette[i % gradientPalette.length]}">
          <a class="card-link" href="${app.href}">
            <header class="card-header">
              <span class="card-emoji" aria-hidden="true">${app.emoji}</span>
              <span class="chip">App</span>
            </header>
            <h3>${app.title}</h3>
            <p>${app.desc}</p>
            <div class="tag-list">${app.tags.map(t=>`<span>${t}</span>`).join('')}</div>
          </a>
        </article>`;
      track.appendChild(item);

      const dot = document.createElement('button');
      dot.className = 'carousel-dot';
      dot.type = 'button';
      dot.setAttribute('role', 'tab');
      dot.setAttribute('aria-label', `Slide ${i+1}`);
      dot.addEventListener('click', () => goTo(i));
      pagination.appendChild(dot);
    });

    measureAndLayout();
    updateActive();
    updateButtons();
  }

  function measureAndLayout(){
    const items = [...track.children];
    if (!items.length) return;
    const cardWidth = items[0].querySelector('.card')?.offsetWidth || items[0].getBoundingClientRect().width;
    const w = Math.min(cardWidth, 360);
    const gap = 24;
    state.step = 360 / items.length;
    state.radius = Math.round((items.length * (w + gap)) / (2 * Math.PI));

    items.forEach((el, i) => {
      const angle = i * state.step;
      el.style.transform = `translate(-50%, -50%) rotateY(${angle}deg) translateZ(${state.radius}px)`;
      el.style.willChange = 'transform';
    });

    applyRotation();
  }

  function applyRotation(){
    track.style.transform = `translateZ(-${state.radius}px) rotateY(${-state.currentIndex * state.step}deg)`;
  }

  function updateActive(){
    const items = [...track.children];
    const dots = [...pagination.children];
    items.forEach((el, i) => {
      const active = i === state.currentIndex;
      el.classList.toggle('is-active', active);
      el.style.zIndex = active ? 3 : 1;
    });
    dots.forEach((d, i) => {
      const active = i === state.currentIndex;
      d.dataset.active = active ? 'true' : 'false';
      d.setAttribute('aria-selected', active ? 'true' : 'false');
    });
  }

  function updateButtons(){
    btnPrev.disabled = false;
    btnNext.disabled = false;
  }

  function goTo(i){
    const n = state.apps.length;
    state.currentIndex = ((i % n) + n) % n;
    applyRotation();
    updateActive();
  }
  const next = () => goTo(state.currentIndex + 1);
  const prev = () => goTo(state.currentIndex - 1);

  // Helpers
  function rotationPerPixel(){ return state.radius ? 180 / (Math.PI * state.radius) : 0; }
  function pointerX(evt){
    if (typeof evt.clientX === 'number') return evt.clientX;
    if (evt.touches && evt.touches.length) return evt.touches[0].clientX;
    if (evt.changedTouches && evt.changedTouches.length) return evt.changedTouches[0].clientX;
    return 0;
  }
  // Gesture handlers — NO pointer capture
  function onPointerDown(e){
    state.pointerDown = true;
    state.isDragging = false;
    state.moved = 0;
    state.dragStartX = pointerX(e);
    state.dragStartY = pointerY(e);
    state.baseRotation = -state.currentIndex * state.step;
    state.swipeStartTime = performance.now();
    state.ignoreClick = false;
    // no preventDefault, no setPointerCapture — keep native click intact
  }

  function onPointerMove(e){
    if (!state.pointerDown) return;
    const x = pointerX(e);
    const dx = x - state.dragStartX;
    state.moved = Math.max(state.moved, Math.abs(dx));

    if (!state.isDragging){
      const DRAG_THRESHOLD = 10;
      if (Math.abs(dx) > DRAG_THRESHOLD){
        state.isDragging = true;
        state.ignoreClick = true;
      } else {
        return;
      }
    }

    const angle = state.baseRotation + (dx * rotationPerPixel());
    track.style.transform = `translateZ(-${state.radius}px) rotateY(${angle}deg)`;
    if (e.cancelable) e.preventDefault(); // stops page scroll while dragging
  }

  function onPointerUp(e){
    if (!state.pointerDown) return;
    state.pointerDown = false;

    const x = pointerX(e);
    const dx = x - state.dragStartX;
    const elapsed = performance.now() - state.swipeStartTime;
    const velocity = Math.abs(dx) / Math.max(elapsed, 1);

    const TAP_PX = 6;
    if (!state.isDragging && Math.abs(dx) < TAP_PX && state.moved < TAP_PX){
      state.ignoreClick = false;
      return;
    }

    // SWIPE
    state.isDragging = false;
    state.ignoreClick = true;
    const angle = state.baseRotation + (dx * rotationPerPixel());
    const approxIndex = Math.round(-angle / state.step);
    if (Math.abs(dx) > 30 || velocity > 0.6){
      goTo(state.currentIndex + (dx < 0 ? 1 : -1));
    } else {
      goTo(approxIndex);
    }

  }

  // Event wiring
  if ('PointerEvent' in window){
    viewport.addEventListener('pointerdown', onPointerDown);
    viewport.addEventListener('pointermove', onPointerMove, { passive:false });
    viewport.addEventListener('pointerup', onPointerUp);
    viewport.addEventListener('pointercancel', onPointerUp);
    viewport.addEventListener('pointerleave', onPointerUp);
  } else {
    viewport.addEventListener('mousedown', onPointerDown);
    viewport.addEventListener('mousemove', onPointerMove);
    viewport.addEventListener('mouseup', onPointerUp);
    viewport.addEventListener('mouseleave', onPointerUp);
    viewport.addEventListener('touchstart', onPointerDown, { passive:true });
    viewport.addEventListener('touchmove', onPointerMove, { passive:false });
    viewport.addEventListener('touchend', onPointerUp);
  }

  track.addEventListener('click', (e) => {
    if (!state.ignoreClick) return;
    e.preventDefault();
    e.stopPropagation();
    state.ignoreClick = false;
  }, true);

  // Keyboard & buttons
  document.getElementById('carousel').addEventListener('keydown',(e)=>{
    if(e.key==='ArrowRight') next();
    if(e.key==='ArrowLeft') prev();
  });
  btnPrev.addEventListener('click', prev);
  btnNext.addEventListener('click', next);

  window.addEventListener('resize', () => { measureAndLayout(); });

  function renderFeatured(){
    const container = document.getElementById('featuredGrid');
    container.innerHTML = '';
    const featured = state.apps.filter(app => app.featured);
    if (!featured.length) return;
    const grid = document.createElement('div');
    grid.className = 'featured-grid';
    featured.forEach(app => {
      const card = document.createElement('a');
      card.className = 'featured-card';
      card.href = app.href;
      card.innerHTML = `
        <header class="card-header">
          <span class="card-emoji" aria-hidden="true">${app.emoji}</span>
          <span class="chip">Featured</span>
        </header>
        <h3>${app.title}</h3>
        <p>${app.desc}</p>
        <div class="tag-list">${app.tags.map(t=>`<span>${t}</span>`).join('')}</div>
      `;
      grid.appendChild(card);
    });
    container.appendChild(grid);
  }

  async function loadApps(){
    try {
      const res = await fetch('./catalog.json');
      if (!res.ok) throw new Error('Failed to load catalog');
      const catalog = await res.json();
      state.apps = catalog.map(app => ({
        slug: app.slug,
        emoji: app.emoji || '🧩',
        title: app.title,
        desc: app.description,
        tags: Array.isArray(app.tags) ? app.tags : [],
        featured: Boolean(app.featured),
        href: `apps/${app.slug}/index.html`
      }));
    } catch (err){
      console.error(err);
      state.apps = [
        { slug:'market-manager', emoji:'🛒', title:'Market Manager', desc:'Working memory under retail pressure.', href:'apps/market-manager/index.html', tags:['executive','memory'] },
        { slug:'cashpoint-coach', emoji:'🏧', title:'CashPoint Coach', desc:'ATM practice with spoken steps.', href:'apps/atm-practice/index.html', tags:['planning','functional'] },
        { slug:'task-juggler', emoji:'🧠', title:'Task Juggler', desc:'Multitask with timed interruptions.', href:'apps/task-juggler/index.html', tags:['executive'] },
        { slug:'emergency-call-simulator', emoji:'📞', title:'Emergency Call Simulator', desc:'Practise structured calls under stress.', href:'apps/emergency-call-simulator/index.html', tags:['attention'] },
        { slug:'fluency-coach', emoji:'💬', title:'Fluency Coach', desc:'Strategy-led verbal fluency.', href:'apps/fluency-coach/index.html', tags:['language'] },
        { slug:'barista-chaos', emoji:'☕', title:'Barista Chaos', desc:'Dual-tasking with orders & timing.', href:'apps/barista-chaos/index.html', tags:['dual-task'] },
        { slug:'maze-explorer', emoji:'🧭', title:'Maze Explorer', desc:'Visuospatial scanning & planning.', href:'apps/maze-explorer/index.html', tags:['visuospatial'] },
        { slug:'plan-with-coco', emoji:'🐦', title:'Plan with Coco', desc:'Prospective memory & routines.', href:'apps/plan-with-coco/index.html', tags:['planning'] }
      ];
    }
    render();
    renderFeatured();
  }

  // Init
  loadApps();
  document.getElementById('last-updated').textContent = `Last updated: ${new Date().toLocaleString()}`;
})();
</script>
</body>
</html>
