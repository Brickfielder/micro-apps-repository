<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Cognitive Rehabilitation Micro-Apps</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f9fafb; --surface:#fff; --surface-alt:#f8f9fc; --text:#1f2937; --muted:#6b7280; --line:#e5e7eb;
    --accent:#ff7a6e; --accent-dark:#f05245; --pill:#f2f4f7; --radius:16px;
    --shadow:0 2px 6px rgba(0,0,0,.08); --shadow-hover:0 22px 44px rgba(15,23,42,.18);
    --header-h:84px; --maxw:1200px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%}
  body{
    font-family:"Inter", system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--text); background:var(--bg); position:relative;
    display:flex; flex-direction:column; min-height:100vh;
    letter-spacing:-0.01em;
  }

  /* Particle canvas behind everything */
  #tsparticles { position: fixed; inset: 0; z-index: -1; }

  /* Header */
  header{
    background:linear-gradient(135deg, rgba(255,255,255,0.92) 10%, rgba(255,245,243,0.9) 90%);
  }
  .nav-shell{
    position:sticky; top:0; z-index:20;
    background:linear-gradient(135deg, rgba(255,255,255,0.96) 10%, rgba(255,245,243,0.94) 90%);
    box-shadow:0 2px 14px rgba(15,23,42,.06);
    border-bottom:1px solid rgba(255,255,255,0.6);
    backdrop-filter:blur(16px);
  }
  .header-inner{
    max-width:var(--maxw);
    margin:0 auto;
    padding:2.6rem 1.25rem 3rem;
    display:flex;
    flex-direction:column;
    gap:1.75rem;
  }
  .topbar{
    max-width:var(--maxw);
    margin:0 auto;
    padding:1.2rem 1.25rem;
    display:flex;
    align-items:center;
    gap:1rem;
    font-size:0.95rem;
    color:var(--muted);
  }
  .brand{display:flex;align-items:center;gap:.75rem;font-weight:700;color:var(--text);letter-spacing:-0.02em;font-size:1rem}
  .brand .badge{display:inline-flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:12px;background:linear-gradient(150deg,var(--accent)0%,var(--accent-dark)90%);color:#fff;font-size:1.35rem;box-shadow:0 12px 24px rgba(240,82,69,.35)}
  .top-links{display:flex;align-items:center;gap:.75rem;margin-left:auto}
  .top-links a{color:inherit;text-decoration:none;padding:.35rem .6rem;border-radius:999px;border:1px solid transparent;transition:.2s}
  .top-links a:hover{border-color:rgba(15,23,42,.08);color:var(--text);background:rgba(255,255,255,0.7)}
  .cta-pill{background:var(--text);color:#fff !important;font-weight:600}

  .hero{display:grid;grid-template-columns:minmax(0,1fr);gap:2.4rem;align-items:center}
  .hero-copy{display:flex;flex-direction:column;gap:1.2rem}
  .hero-eyebrow{font-size:.9rem;font-weight:600;text-transform:uppercase;letter-spacing:.18em;color:var(--accent-dark)}
  .hero h1{margin:0;font-size:clamp(2.4rem, 3vw + 1.8rem, 3.3rem);font-weight:800;line-height:1.05;color:#101828}
  .hero p{margin:0;font-size:1.05rem;line-height:1.6;color:color-mix(in oklab,var(--text),white 25%)}
  .hero-actions{display:flex;flex-wrap:wrap;gap:.75rem;margin-top:.5rem}
  .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.7rem 1.3rem;border-radius:999px;font-weight:600;text-decoration:none;border:1px solid transparent;transition:.2s;font-size:.95rem;cursor:pointer}
  .btn.primary{background:linear-gradient(140deg,var(--accent)0%,var(--accent-dark)92%);color:#fff;box-shadow:0 20px 30px rgba(240,82,69,.25)}
  .btn.primary:hover{transform:translateY(-1px);box-shadow:0 24px 40px rgba(240,82,69,.28)}
  .btn.secondary{background:rgba(255,255,255,0.75);border-color:rgba(15,23,42,.08);color:var(--text)}
  .btn.secondary:hover{background:#fff;border-color:rgba(15,23,42,.15)}
  .hero-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.85rem;margin-top:.25rem}
  .hero-stats .stat{padding:.85rem 1rem;border-radius:var(--radius);background:rgba(255,255,255,0.78);border:1px solid rgba(15,23,42,.05);box-shadow:0 8px 20px rgba(15,23,42,.08)}
  .hero-stats dt{margin:0;font-weight:700;font-size:1.6rem;color:#0f172a}
  .hero-stats dd{margin:.15rem 0 0;font-size:.85rem;color:var(--muted)}
  @media(max-width:720px){
    .topbar{flex-direction:column;align-items:flex-start;gap:.5rem;padding:1rem 1.1rem}
    .top-links{width:100%;justify-content:flex-start;flex-wrap:wrap}
    .hero{gap:2rem}
  }

  /* Layout */
  main{ flex:1; max-width:var(--maxw); margin:1.5rem auto 3rem; padding:0 1rem; }

  .hero{
    background:linear-gradient(135deg,rgba(255,255,255,0.92) 0%,rgba(255,240,236,0.88) 40%,rgba(240,247,255,0.9) 100%);
    border:1px solid rgba(255,255,255,0.6);
    border-radius:calc(var(--radius) + 12px);
    padding:3.2rem clamp(1.5rem, 5vw, 3rem);
    position:relative;
    overflow:hidden;
    box-shadow:0 40px 80px rgba(15,23,42,0.08);
    margin-bottom:2.5rem;
  }
  .hero::after{
    content:""; position:absolute; inset:auto -25% -40% auto;
    width:420px; height:420px;
    background:radial-gradient(circle,#ffe2db 0%,rgba(255,255,255,0) 70%);
    opacity:.7; pointer-events:none;
  }
  .hero-content{position:relative; z-index:1; max-width:620px;}
  .hero h2{margin:0 0 1.2rem; font-size:clamp(2.3rem, 4vw, 3.1rem); line-height:1.1; letter-spacing:-0.02em;}
  .hero p{margin:0 0 1.6rem; font-size:1.1rem; line-height:1.65; color:#334155;}
  .hero-actions{display:flex; gap:.75rem; flex-wrap:wrap;}
  .cta-btn{
    background:var(--accent); color:#fff; font-weight:600; font-size:1rem;
    border:none; border-radius:999px; padding:.75rem 1.5rem;
    box-shadow:0 18px 30px rgba(255,122,110,0.35); cursor:pointer; transition:.2s ease;
  }
  .cta-btn:hover{transform:translateY(-2px); background:#ff6b5d;}
  .ghost-btn{
    background:rgba(255,255,255,0.6); border:1px solid rgba(148,163,184,0.45);
    color:#0f172a; font-weight:600; border-radius:999px; padding:.75rem 1.35rem;
    backdrop-filter:blur(8px); cursor:pointer; transition:.2s ease;
  }
  .ghost-btn:hover{background:rgba(255,255,255,0.85);}

  .hero-list{display:grid; gap:.6rem; margin-top:1.5rem; padding:0; list-style:none;}
  .hero-list li{display:flex; gap:.65rem; align-items:flex-start; color:#475569; font-size:1rem;}
  .hero-list li span{width:26px; height:26px; border-radius:8px; background:rgba(148,163,184,0.18); display:grid; place-items:center; color:var(--accent); font-size:1.1rem;}

  .metrics{display:flex; flex-wrap:wrap; gap:1rem; margin-top:2.5rem;}
  .metric-card{
    flex:1 1 140px; background:rgba(255,255,255,0.75);
    border:1px solid rgba(226,232,240,0.9);
    border-radius:18px; padding:1rem 1.25rem;
    backdrop-filter:blur(6px);
  }
  .metric-value{font-size:1.9rem; font-weight:700; margin:0; color:#0f172a;}
  .metric-label{margin:.2rem 0 0; color:#64748b; font-size:.95rem;}

  /* Disclaimer card */
  .disclaimer{
    --disc-accent: var(--accent);
    background: var(--surface);
  border: 1px solid var(--line);
  border-radius: calc(var(--radius) - 2px);
  padding: 0.85rem 1rem 1rem;
  box-shadow: var(--shadow);
  margin: 0 0 1.2rem 0;
  position: relative;
  overflow: hidden;
  isolation: isolate;
}
.disclaimer::before{
  content:"";
  position:absolute; inset:0 0 0 auto;
  width:6px;
  background: linear-gradient(
    180deg,
    color-mix(in oklab, var(--disc-accent), white 0%) 0%,
    color-mix(in oklab, var(--disc-accent), white 22%) 100%
  );
}
.disc-head{
  display:flex; align-items:center; gap:.75rem; margin-bottom:.25rem;
}
.disc-icon{
  width:2.25rem; height:2.25rem; flex:0 0 auto;
  display:grid; place-items:center;
  border-radius:9px;
  background: color-mix(in oklab, var(--accent), white 88%);
  border: 1px solid color-mix(in oklab, var(--accent), white 60%);
  font-size:1.25rem;
}
.disclaimer h2{
  margin:0; font-size:clamp(1.05rem, 1.2vw + .8rem, 1.25rem); line-height:1.2;
}
.disclaimer p{
  margin:.5rem 0 .35rem; color:var(--text);
  font-size:clamp(.95rem, .4vw + .85rem, 1rem); line-height:1.55;
}
.disclaimer .muted{ color:var(--muted); font-size:.95rem; }
.disclaimer .disc-actions{
  margin-top:.6rem; display:flex; gap:.5rem; flex-wrap:wrap;
}
.disclaimer .chip-btn{
  padding:.45rem .7rem; border-radius:999px; border:1px solid var(--line);
  background: var(--pill); font-size:.9rem; cursor:pointer;
}
.disclaimer .chip-btn:hover{
  background: color-mix(in oklab, var(--pill), var(--line) 14%);
}
@media (max-width: 560px){
  .disclaimer{ padding:.75rem .85rem .9rem; }
  .disc-head{ gap:.6rem; }
  .disc-icon{ width:2rem; height:2rem; font-size:1.1rem; border-radius:8px; }
}

  /* Picks */
  .picks{
    background:var(--surface);
    border:1px solid var(--line);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:1.25rem 1.4rem;
    margin:0 0 1.2rem 0;
    position:relative;
    overflow:hidden;
  }
  .picks::before{content:"";position:absolute;inset:0;pointer-events:none;background:linear-gradient(135deg,rgba(255,122,110,.12),transparent 55%)}
  .picks h2{ margin:0 0 .7rem 0; font-size:1.2rem; display:flex; align-items:center; gap:.5rem; }
  .picks h2::before{content:"‚≠ê";font-size:1.1rem}
  .picks .picks-row{
    display:grid; gap:1.25rem;
  }
  @media(min-width:900px){ .picks .picks-row{ grid-template-columns:repeat(2,1fr) } }
  @media(min-width:1200px){ .picks .picks-row{ grid-template-columns:repeat(3,1fr) } }

  /* Filter bar */
  .filterbar{
    display:flex; flex-wrap:wrap; gap:.55rem;
    align-items:center;
    background:var(--surface);
    border:1px solid var(--line);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:.75rem .9rem;
    margin:0 0 1.2rem 0;
  }
  .filterbar .label{ font-weight:600; color:#0f172a; margin-right:.25rem; }
  .search-input{
    flex:1 1 220px;
    position:relative;
  }
  .search-input input{
    width:100%;
    padding:.55rem 2.3rem .55rem 2.1rem;
    border-radius:999px;
    border:1px solid rgba(15,23,42,.08);
    background:var(--pill);
    font-size:.95rem;
  }
  .search-input svg{
    position:absolute;
    left:0.85rem;
    top:50%;
    transform:translateY(-50%);
    width:1rem; height:1rem; color:var(--muted);
  }
  .chip{
    display:inline-flex; align-items:center; gap:.35rem;
    padding:.35rem .65rem; border-radius:9999px; border:1px solid var(--line);
    background:var(--pill); font-size:.9rem; cursor:pointer; user-select:none;
  }
  .chip[data-active="true"]{
    background: color-mix(in oklab, var(--accent), white 85%);
    border-color: var(--accent);
  }
  .chip.clear{ background:#fff; }
  .filterbar .count{ margin-left:auto; color:var(--muted); font-size:.9rem; }
  .search{
    flex:1 1 220px; display:flex; align-items:center; gap:.5rem;
    border-radius:999px; background:#fff; border:1px solid rgba(203,213,225,0.9);
    padding:.35rem .8rem;
  }
  .search input{
    border:none; outline:none; flex:1; font-size:.95rem; font-family:inherit; background:transparent;
  }
  .search svg{ width:1rem; height:1rem; stroke:#64748b; }

  /* Grid (all apps) */
  .grid{ display:grid; gap:1rem }
  @media(min-width:900px){ .grid{ grid-template-columns:repeat(2,1fr) } }
  @media(min-width:1200px){ .grid{ grid-template-columns:repeat(3,1fr) } }

  /* Card */
  .card{
    display:flex; flex-direction:column; justify-content:space-between;
    text-decoration:none; color:inherit;
    background:var(--surface); border-radius:calc(var(--radius) + 4px);
    padding:1.15rem; box-shadow:var(--shadow); transition:.25s ease;
    border:1px solid rgba(15,23,42,.06);
    position:relative; overflow:hidden;
    aspect-ratio: 3 / 2;
    min-height: 190px;
  }
  .card:hover{ transform:translateY(-6px); box-shadow:var(--shadow-hover); border-color:color-mix(in oklab, var(--accent), white 60%); }

  .title{ font-weight:700; font-size:1.25rem; margin-bottom:.5rem;
          display:flex; align-items:center; gap:.5rem; }
  .emoji{ font-size:1.6rem; line-height:1 }
  .desc{ color:var(--muted); font-size:1rem; line-height:1.5; margin-bottom:.8rem;
         overflow:hidden; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; }
  .tag{ background:var(--pill); padding:.3rem .7rem; border-radius:9999px; font-size:.85rem; white-space:nowrap; }
  .tags{display:flex;flex-wrap:wrap;gap:.4rem}

  /* Footer */
  .site-footer{
    background:linear-gradient(180deg,rgba(255,255,255,0.85) 0%,rgba(241,245,249,0.95) 100%);
    border-top: 1px solid rgba(226,232,240,0.9);
    padding: 2rem 1.25rem 2.5rem;
    text-align: center;
    font-size: 0.95rem;
    color: var(--muted);
  }
  .site-footer a{ color: var(--accent); text-decoration: none; }
  .site-footer a:hover{ text-decoration: underline; }

  @media(max-width:720px){
    .header-inner{flex-direction:column; align-items:flex-start; text-align:left;}
    .nav-actions{width:100%; justify-content:flex-start;}
    .hero{padding:2.4rem 1.4rem;}
    .metrics{flex-direction:column;}
    .card{min-height:210px;}
  }
</style>
</head>
<body>
<!-- Particle background -->
<div id="tsparticles"></div>

<header>
  <div class="nav-shell">
    <div class="topbar">
      <span class="brand"><span class="badge">¬µ</span> Cognitive Rehab Lab</span>
      <nav class="top-links" aria-label="Primary">
        <a href="#picks">Featured</a>
        <a href="#grid">Browse library</a>
        <a href="https://github.com/marcomion/micro-apps" target="_blank" rel="noopener">GitHub</a>
        <a class="cta-pill" href="mailto:m.mion@nhs.net">Partner with us</a>
      </nav>
    </div>
  </div>

  <div class="header-inner">
    <div class="hero">
      <div class="hero-copy">
        <span class="hero-eyebrow">Cognitive rehabilitation micro-experiences</span>
        <h1>Beautifully crafted clinical tools you can try in minutes.</h1>
        <p>
          Explore an evolving lab of lightweight, evidence-aligned applications that support assessment,
          therapy practice, and research collaboration for clinicians and scientists.
        </p>
        <div class="hero-actions">
          <a class="btn primary" href="#grid">Browse the collection</a>
          <a class="btn secondary" href="mailto:m.mion@nhs.net">Discuss a project</a>
        </div>
        <dl class="hero-stats" aria-live="polite">
          <div class="stat">
            <dt id="statApps">0</dt>
            <dd>Micro-apps available</dd>
          </div>
          <div class="stat">
            <dt id="statTags">0</dt>
            <dd>Clinical focus areas</dd>
          </div>
          <div class="stat">
            <dt id="statFeatured">0</dt>
            <dd>Curated editor‚Äôs picks</dd>
          </div>
        </dl>
      </div>
    </div>
  </div>
</header>

<footer class="site-footer">
  <p>
    ¬© 2025 Cognitive Rehabilitation Micro-Apps ‚Äî Licensed under the 
    <a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener">Apache 2.0 License</a>.
  </p>
  <p>
    Contact: <a href="mailto:m.mion@nhs.net">m.mion@nhs.net</a> ¬∑ 
    <a href="https://www.linkedin.com/in/marco-mion/" target="_blank" rel="noopener">LinkedIn</a>
  </p>
  <p id="last-updated" class="muted"></p>
</footer>

<!-- tsParticles -->
<script src="https://cdn.jsdelivr.net/npm/tsparticles@2/tsparticles.bundle.min.js"></script>
<script>
  // ==== Particles ====
  tsParticles.load("tsparticles", {
    background: { color: "#f9fafb" },
    particles: {
      number: { value: 60, density: { enable: true, value_area: 800 } },
      color: { value: "#94a3b8" }, shape: { type: "circle" }, opacity: { value: 0.5 }, size: { value: 2 },
      line_linked: { enable: true, distance: 120, color: "#cbd5e1", opacity: 0.4, width: 1 },
      move: { enable: true, speed: 1.2, outModes: { default: "bounce" } }
    },
    interactivity: { events: { onhover: { enable: true, mode: "grab" }, resize: true },
      modes: { grab: { distance: 140, line_linked: { opacity: 0.7 } } } },
    retina_detect: true
  });

  // ==== Setup ====
  const grid = document.getElementById('grid');
  const picksSection = document.getElementById('picks');
  const picksRow = document.getElementById('picksRow');
  const countLabel = document.getElementById('countLabel');
  const allChip = document.getElementById('allChip');
  const clearChip = document.getElementById('clearChip');
  const searchInput = document.getElementById('searchInput');
  const statApps = document.getElementById('statApps');
  const statTags = document.getElementById('statTags');
  const statFeatured = document.getElementById('statFeatured');

  const getSearchTerm = () => searchInput ? (searchInput.value || '') : '';
  const setStat = (el, value) => { if (el) el.textContent = value; };

  function getBasePath(){
    const parts = (location.pathname || "/").split("/").filter(Boolean);
    return parts.length ? `/${parts[0]}` : "";
  }
  const BASE = getBasePath();

  // Fallback picks (if catalog items don‚Äôt contain featured:true)
  const EDITORS_PICKS_FALLBACK = [
    // üëâ add slugs here if your catalog doesn‚Äôt mark items as { featured: true }
    // 'barista-chaos', 'audio-errands'
  ];

  async function loadCatalog(){
    const candidates = [
      `${BASE}/catalog.json`,
      `${BASE}/docs/catalog.json`,
      `${BASE}/shared/catalog.json`
    ];
    for (const url of candidates){
      try { const r = await fetch(url, { cache: 'no-store' }); if (r.ok) return await r.json(); } catch(_){}
    }
    throw new Error('catalog.json not found in expected locations');
  }

  async function resolveAppUrl(slug){
    const candidates = [
      `${BASE}/apps/${slug}.html`,
      `${BASE}/apps/${slug}/index.html`,
      `${BASE}/apps/${slug}/`,
      `${BASE}/docs/apps/${slug}.html`,
      `${BASE}/docs/apps/${slug}/index.html`,
      `${BASE}/docs/apps/${slug}/`
    ];
    for (const url of candidates){
      try { const r = await fetch(url, { method:'HEAD', cache:'no-store' }); if (r.ok) return url; } catch(_){}
    }
    return `${BASE}/apps/${slug}.html`;
  }

  function cardHTML(app){
    return `
      <div>
        <div class="title"><span class="emoji">${app.emoji ?? 'üß©'}</span> ${app.title ?? app.slug}</div>
        <p class="desc">${app.description ?? ''}</p>
      </div>
      ${Array.isArray(app.tags) && app.tags.length
        ? `<div class="tags">${app.tags.map(t=>`<span class="tag">${t}</span>`).join('')}</div>`
        : '' }
    `;
  }

  // Click-through routing
  function wireCardClicks(container){
    container.addEventListener('click', async (e) => {
      const a = e.target.closest('a.card'); if (!a) return;
      e.preventDefault();
      const slug = a.getAttribute('data-slug');
      const url = await resolveAppUrl(slug);
      location.href = url;
    });
  }
  wireCardClicks(grid); wireCardClicks(picksRow);

  // Build tag chips (unique, sorted)
  function buildTagChips(allApps){
    const tagSet = new Set();
    allApps.forEach(a => (a.tags||[]).forEach(t => tagSet.add(t)));
    const tags = Array.from(tagSet).sort((a,b)=>a.localeCompare(b));

    const frag = document.createDocumentFragment();
    tags.forEach(tag => {
      const btn = document.createElement('button');
      btn.className = 'chip';
      btn.type = 'button';
      btn.textContent = tag;
      btn.dataset.tag = tag;
      btn.dataset.active = 'false';
      frag.appendChild(btn);
    });

    // Insert before the Clear chip
    clearChip.parentNode.insertBefore(frag, clearChip);
  }

  // Rendering helpers
  function renderCards(container, apps){
    const nodes = apps.map(app => {
      const a = document.createElement('a');
      a.className = 'card';
      a.setAttribute('data-slug', app.slug);
      a.href = `${BASE}/apps/${app.slug}.html`;
      a.innerHTML = cardHTML(app);
      return a;
    });
    container.replaceChildren(...nodes);
  }

  function updateCount(n){
    countLabel.textContent = `${n} app${n===1?'':'s'}`;
  }

  // Tag filtering (OR logic across selected tags)
  function getSelectedTags(){
    return Array.from(document.querySelectorAll('.chip[data-tag][data-active="true"]')).map(el => el.dataset.tag);
  }
  function filterApps(apps, selected, term){
    const normalized = term.trim().toLowerCase();
    return apps.filter(app => {
      const tags = app.tags || [];
      const matchesTags = !selected.length || selected.some(t => tags.includes(t));
      if (!matchesTags) return false;
      if (!normalized) return true;
      const haystack = `${app.title || ''} ${app.description || ''} ${app.slug || ''}`.toLowerCase();
      return haystack.includes(normalized);
    });
  }

  (async () => {
    // Load + render
    let catalog = await loadCatalog();
    if (!Array.isArray(catalog)) catalog = [];

    // Picks
    const picks = catalog.filter(a => a.featured === true);
    if (picks.length === 0 && EDITORS_PICKS_FALLBACK.length){
      catalog.forEach(a => { if (EDITORS_PICKS_FALLBACK.includes(a.slug)) picks.push(a); });
    }
    if (picks.length){
      renderCards(picksRow, picks.slice(0, 6)); // show up to 6
      picksSection.hidden = false;
      setStat(statFeatured, picks.length);
    } else {
      setStat(statFeatured, '0');
    }

    // Build filter chips & initial grid
    buildTagChips(catalog);
    renderCards(grid, catalog);
    updateCount(catalog.length);
    setStat(statApps, catalog.length);
    const uniqueTags = new Set();
    catalog.forEach(app => (app.tags || []).forEach(tag => uniqueTags.add(tag)));
    setStat(statTags, uniqueTags.size);

    // Filter interactions
    function refresh(){
      const selected = getSelectedTags();
      const filtered = filterApps(catalog, selected, getSearchTerm());
      renderCards(grid, filtered);
      updateCount(filtered.length);
      allChip.dataset.active = selected.length ? 'false' : 'true';
    }

    document.querySelector('.filterbar').addEventListener('click', (e)=>{
      const chip = e.target.closest('.chip');
      if (!chip) return;

      if (chip === allChip){
        // reset all
        document.querySelectorAll('.chip[data-tag]').forEach(el => el.dataset.active = 'false');
        if(searchInput) searchInput.value = '';
        refresh();
        return;
      }
      if (chip === clearChip){
        document.querySelectorAll('.chip[data-tag]').forEach(el => el.dataset.active = 'false');
        if(searchInput) searchInput.value = '';
        refresh();
        return;
      }
      if (chip.hasAttribute('data-tag')){
        // toggle
        const active = chip.dataset.active === 'true';
        chip.dataset.active = active ? 'false' : 'true';
        refresh();
      }
    });

    if (searchInput){
      searchInput.addEventListener('input', () => {
        refresh();
      });
    }
  })().catch(err => {
    console.error(err);
    grid.innerHTML = `<p class="desc">Could not load <code>catalog.json</code>.</p>`;
  });

  // Last updated (document build date)
  const stamp = new Date(document.lastModified);
  document.getElementById("last-updated").textContent =
    "Last updated: " + stamp.toLocaleDateString(undefined, { year: "numeric", month: "long", day: "numeric" });
</script>
  <script>
  (function(){
    const key = "crma_disclaimer_hidden";
    const sec = document.getElementById("disclaimer");
    const btn = document.getElementById("discHideBtn");
    if(!sec || !btn) return;

    function apply(){
      const hidden = localStorage.getItem(key) === "1";
      sec.style.display = hidden ? "none" : "";
      btn.textContent = hidden ? "Show disclaimer" : "Hide";
    }
    btn.addEventListener("click", () => {
      const hidden = localStorage.getItem(key) === "1";
      localStorage.setItem(key, hidden ? "0" : "1");
      apply();
    });
    apply();
  })();
</script>
</body>
</html>
