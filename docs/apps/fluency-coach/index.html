<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>Fluency Coach Ã¢â‚¬â€ Strategy-Led Verbal Fluency</title>
<style>
  :root{
    --bg:#f7f8fb; --card:#fff; --ink:#1f2937; --muted:#6b7280; --brand:#0a66c2; --good:#0f766e; --warn:#b45309; --bad:#b91c1c;
    --pill:#eef2ff; --shadow:0 10px 24px rgba(0,0,0,.08); --ring:0 0 0 3px rgba(10,102,194,.18);
  }
  *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  body{margin:0;background:var(--bg);color:var(--ink);line-height:1.4}
  header{padding:20px 16px 8px;text-align:center}
  h1{margin:0 0 6px;font-weight:800;letter-spacing:.2px}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  .row{display:grid;gap:16px}
  .cols-3{grid-template-columns:repeat(3,1fr)}
  .cols-2{grid-template-columns:repeat(2,1fr)}
  .card{background:var(--card);border-radius:16px;box-shadow:var(--shadow);padding:16px}
  .k{font-size:.88rem;color:var(--muted)}
  select,button,input[type="text"],textarea{
    font:inherit;border:1px solid #d1d5db;border-radius:12px;padding:10px 12px;background:#fff;outline:none
  }
  select:focus,input:focus,textarea:focus{box-shadow:var(--ring);border-color:#93c5fd}
  button{cursor:pointer;background:var(--brand);color:#fff;border:none}
  button.ghost{background:#fff;color:var(--ink);border:1px solid #e5e7eb}
  button.secondary{background:#f3f4f6;color:#111827}
  button:disabled{opacity:.5;cursor:not-allowed}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:var(--pill);margin:4px 6px 0 0;font-size:.9rem}
  .tips li{margin:.25rem 0}
  .status{display:flex;gap:8px;flex-wrap:wrap}
  .status .tag{font-size:.8rem;padding:6px 8px;border-radius:999px}
  .ok{background:#ecfdf5;color:var(--good)}
  .rep{background:#fff7ed;color:var(--warn)}
  .off{background:#fef2f2;color:var(--bad)}
  .live{font-variant-numeric:tabular-nums;font-weight:700}
  .grid{display:grid;grid-template-columns: 110px 1fr 110px 110px 110px;gap:8px;align-items:center}
  .hdr{font-size:.86rem;color:#374151}
  .item{padding:8px;border-bottom:1px dashed #e5e7eb}
  .word{font-weight:700}
  .flex{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .small{font-size:.86rem;color:var(--muted)}
  .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
  .strategy{background:#f8fafc;border:1px dashed #e5e7eb;border-radius:12px;padding:12px;margin-top:8px}
  .foot{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
  .notice{background:#fff7ed;border:1px solid #fed7aa;color:#92400e;padding:8px 12px;border-radius:10px}
  .groups{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
  .grp{background:#f9fafb;border:1px dashed #e5e7eb;border-radius:12px;padding:12px}
  .grp h4{margin:0 0 6px}
</style>
<meta content="Fluency_Coach" name="app-slug"/><link href="/shared/theme.css" rel="stylesheet"/><script defer="" src="/shared/frame.js"></script><link href="../../../shared/theme.css" rel="stylesheet"/><script defer="" src="../../../shared/frame.js"></script><script defer="" src="../../../shared/clinician_feedback.js"></script>  <meta name="app-slug" content="fluency-coach">
</head>
<body><main id="app-root">
<header>
<h1>Fluency Coach</h1>
<div class="k">Strategy-led verbal fluency with voice input, repetition detection, expanded category checking, and end-of-session grouping.</div>
</header>
<div class="wrap">
<div class="row cols-3">
<div class="card">
<h3>1) Setup</h3>
<div class="flex">
<label>Category
          <select id="category">
<option value="animals">Animals</option>
<option value="produce">Fruits &amp; Vegetables</option>
<option value="tools">Tools &amp; Household Objects</option>
<option value="jobs">Occupations</option>
<option value="transport">Transportation Modes</option>
<option value="emotions">Emotions</option>
</select>
</label>
<label>Duration
          <select id="duration">
<option>60</option>
<option>90</option>
<option>45</option>
<option>30</option>
<option>15</option>
</select>
</label>
<label>Input
          <select id="inputMode">
<option value="speech">Ã°Å¸Å½Â¤ Speech</option>
<option value="manual">Ã¢Å’Â¨Ã¯Â¸Â Manual</option>
</select>
</label>
</div>
<div class="flex" style="margin-top:8px">
<label class="small"><input checked="" id="useExtended" type="checkbox"/> Use extended lexicon (broader matching)</label>
</div>
<div class="notice small" id="speechWarn" style="display:none;margin-top:10px">
        Speech recognition not available in this browser. Use Chrome desktop, or choose Manual input.
      </div>
<div class="strategy" id="strategyBox">
<div class="small"><strong>Strategy coach</strong> (read before starting)</div>
<ul class="tips small" id="tips"></ul>
</div>
<div class="foot">
<div class="status">
<span class="tag ok">On-target: <span class="live" id="okCount">0</span></span>
<span class="tag rep">Repetitions: <span class="live" id="repCount">0</span></span>
<span class="tag off">Off-target: <span class="live" id="offCount">0</span></span>
</div>
<div class="live">Ã¢ÂÂ±Ã¯Â¸Â <span id="timer">60</span>s</div>
</div>
<div class="flex" style="margin-top:8px">
<button id="btnStart">Start</button>
<button class="secondary" disabled="" id="btnPause">Pause</button>
<button class="ghost" disabled="" id="btnStop">Stop</button>
<button class="ghost" disabled="" id="btnExport">Download CSV</button>
</div>
<div class="flex" id="manualBox" style="display:none;margin-top:8px">
<input id="manualInput" placeholder="Type a word and press EnterÃ¢â‚¬Â¦" type="text"/>
<button class="secondary" id="btnAdd">Add</button>
</div>
<div class="small" style="margin-top:8px">
        Tip: speak single words clearly (e.g., Ã¢â‚¬Å“dogÃ¢â‚¬Â, Ã¢â‚¬Å“catÃ¢â‚¬Â). Multi-word items are allowed; you can approve flagged items.
      </div>
</div>
<div class="card">
<h3>2) Live Responses</h3>
<div class="grid hdr">
<div>+Time</div><div>Word</div><div>Status</div><div>Override</div><div>Delete</div>
</div>
<div id="list"></div>
</div>
<div class="card">
<h3>3) Session Notes</h3>
<textarea id="notes" placeholder="Clinician notes (e.g., strategy use, cues, fatigue)Ã¢â‚¬Â¦" rows="10" style="width:100%;border-radius:12px;border:1px solid #e5e7eb;padding:10px"></textarea>
<div class="small" style="margin-top:8px">Overrides are logged in the CSV. You can approve items flagged as off-target/unknown.</div>
</div>
</div>
<div class="row cols-1" style="margin-top:12px">
<div class="card">
<h3>4) Strategy Grouping (end of session)</h3>
<div class="small">When you press <b>Stop</b>, valid items are automatically grouped into suggested sub-categories. Use this to teach/reflect on chunking.</div>
<div class="groups" id="groups" style="margin-top:10px"></div>
</div>
</div>
</div>
<script>
/* ========= Expanded Lexicons =========
   Notes:
   - We keep a base lexicon + extended banks per category.
   - Normalization handles plurals, apostrophes.
   - Heuristics broaden matching (e.g., *-fish, *-bird).
*/
const BASE = {
   animals: new Set([
    "dog","cat","horse","cow","sheep","goat","pig","rabbit","mouse","rat","hamster","guinea pig",
    "elephant","lion","tiger","bear","wolf","fox","deer","giraffe","zebra","monkey","gorilla",
    "chimpanzee","orangutan","panda","koala","kangaroo","camel","hippo","rhinoceros","rhino",
    "crocodile","alligator","snake","python","boa","lizard","gecko","iguana","chameleon","turtle",
    "tortoise","frog","toad","salamander","newt",
    "shark","whale","dolphin","porpoise","seal","sea lion","walrus","otter","manatee","dugong",
    "octopus","squid","cuttlefish","jellyfish","crab","lobster","shrimp","prawn","starfish",
    "salmon","tuna","cod","trout","herring","sardine","anchovy","carp","pike",
    "eagle","hawk","falcon","owl","vulture","buzzard","kite","parrot","macaw","cockatoo","parakeet",
    "pigeon","dove","sparrow","finch","robin","blackbird","thrush","swallow","swift","magpie","jay",
    "crow","raven","stork","heron","egret","pelican","cormorant","kingfisher","woodpecker",
    "duck","goose","swan","turkey","chicken","rooster","hen",
    "bee","wasp","hornet","ant","termite","beetle","ladybird","butterfly","moth","dragonfly",
    "grasshopper","cricket","spider","scorpion","snail","slug","earthworm","centipede","millipede",
    "badger","hedgehog","mole","weasel","stoat","ferret","raccoon","skunk","beaver","otter","boar",
    "bison","buffalo","yak","moose","reindeer","donkey","mule","horse","pony","camel","llama","alpaca"
  ]),

  produce: new Set([
    // fruits
    "apple","pear","quince","medlar","banana","plantain","orange","mandarin","tangerine","clementine",
    "grapefruit","pomelo","lemon","lime","kumquat","bergamot",
    "peach","nectarine","apricot","plum","cherry",
    "grape","raisin","sultana","currant","blackcurrant","redcurrant","whitecurrant",
    "strawberry","blueberry","raspberry","blackberry","boysenberry","cranberry","gooseberry",
    "kiwi","mango","papaya","pineapple","passionfruit","pomegranate","fig","date","olive","avocado",
    "melon","watermelon","cantaloupe","honeydew","persimmon","guava","lychee","longan","rambutan",
    "dragonfruit","starfruit","jackfruit","durian",
    // veg
    "tomato","potato","sweet potato","yam","carrot","parsnip","turnip","swede","beetroot","radish",
    "onion","shallot","spring onion","scallion","leek","garlic","ginger","galangal","turmeric",
    "cabbage","savoy","red cabbage","white cabbage","kale","collard","chard","spinach",
    "lettuce","romaine","iceberg","endive","radicchio","rocket","arugula","watercress","bok choy","pak choi",
    "broccoli","cauliflower","romanesco","brussels sprout",
    "cucumber","gherkin","courgette","zucchini","pumpkin","squash","butternut","acorn squash","spaghetti squash",
    "pepper","bell pepper","chili","chilli","jalapeno","habanero","poblano",
    "aubergine","eggplant","okra","celery","fennel","artichoke","asparagus",
    "pea","mange tout","sugar snap","green bean","runner bean","broad bean","kidney bean","black bean","chickpea","lentil",
    "corn","maize","sweetcorn","mushroom","truffle","seaweed","nori","wakame","kombu","edamame","soybean"
  ]),

  tools: new Set([
    // hand tools
    "hammer","mallet","sledgehammer","screwdriver","philips screwdriver","flat screwdriver","torx driver",
    "wrench","spanner","adjustable wrench","socket","ratchet","torque wrench","allen key","hex key",
    "pliers","needle nose pliers","locking pliers","vice grip","wire cutter","bolt cutter",
    "saw","handsaw","hacksaw","backsaw","coping saw","jigsaw","circular saw","mitre saw","table saw",
    "chisel","wood chisel","cold chisel","plane","spokeshave","rasp","file",
    "utility knife","box cutter","stanley knife","scissors","shears","snips",
    "tape measure","ruler","square","set square","combination square","spirit level","plumb line","protractor",
    "clamp","g clamp","spring clamp","bench vice","vise",
    // power / shop
    "drill","impact driver","rotary tool","dremel","angle grinder","sander","belt sander","orbital sander",
    "router","nailer","staple gun","heat gun","hot glue gun","soldering iron","multimeter",
    // painting / marking / safety
    "paintbrush","roller","tray","masking tape","painter tape","drop cloth","sandpaper","putty knife","scraper",
    "glue","epoxy","superglue","wood glue",
    "safety glasses","goggles","earplug","ear defender","dust mask","respirator","work glove",
    // household
    "broom","brush","mop","bucket","dustpan","vacuum","iron","kettle","toaster","microwave","oven","hob",
    "spatula","whisk","ladle","tongs","peeler","grater","colander","sieve","measuring cup","measuring jug","scale",
    "knife","chef knife","paring knife","bread knife","cutting board","pan","pot","skillet","wok"
  ]),

  jobs: new Set([
    // health
    "doctor","physician","surgeon","nurse","midwife","paramedic","psychologist","psychiatrist","therapist",
    "physiotherapist","occupational therapist","speech therapist","speech pathologist","radiographer",
    "pharmacist","dentist","dental hygienist","optometrist","ophthalmologist","podiatrist","dietitian",
    "anesthesiologist","anaesthetist","neurologist","cardiologist","urologist","dermatologist","gp","family doctor",
    // education / research
    "teacher","teaching assistant","lecturer","professor","researcher","scientist","librarian",
    // trades / construction
    "electrician","plumber","carpenter","joiner","bricklayer","roofer","painter","decorator","tiler",
    "builder","labourer","mechanic","hvac technician","welder","machinist",
    // tech / business
    "software engineer","developer","programmer","data scientist","statistician","analyst","qa tester",
    "product manager","project manager","scrum master","designer","ux designer","ui designer","architect",
    "devops engineer","cloud architect","it support","sysadmin",
    "accountant","bookkeeper","auditor","economist","banker","trader",
    // law / public / emergency
    "lawyer","barrister","solicitor","judge","clerk","civil servant","diplomat","police officer","firefighter",
    // media / arts
    "journalist","editor","copywriter","proofreader","photographer","videographer","cinematographer","musician",
    "singer","actor","artist","illustrator","filmmaker","producer","director",
    // hospitality / retail / transport
    "chef","cook","baker","butcher","barista","bartender","waiter","waitress","receptionist","cashier",
    "shop assistant","salesperson","retail manager","porter","cleaner","security guard",
    "driver","bus driver","lorry driver","taxi driver","pilot","flight attendant","train driver","conductor",
    // social / support
    "social worker","counsellor","counselor","psychotherapist","care assistant","support worker","coach","mentor"
  ]),

  transport: new Set([
    // road
    "car","hatchback","sedan","saloon","estate","wagon","coupe","convertible","minivan","van","pickup","pickup truck",
    "suv","jeep","truck","lorry","bus","coach","minibus","taxi","cab",
    "motorbike","motorcycle","scooter","moped","segway","hoverboard",
    // rail
    "train","intercity","high speed train","light rail","tram","monorail","subway","underground","metro","trolleybus",
    // human powered / animal
    "bicycle","bike","tricycle","rollerblades","skateboard","kick scooter","rickshaw","tuk-tuk","auto rickshaw",
    "horseback","camel","dogsled",
    // water
    "boat","ship","ferry","canoe","kayak","rowboat","dinghy","yacht","sailboat","catamaran","gondola","barge","hydrofoil","submarine",
    // air / space
    "plane","airplane","aeroplane","jet","biplane","seaplane","glider","helicopter","dirigible","zeppelin",
    "hot air balloon","rocket","spaceship","space shuttle","capsule","drone"
  ]),

  emotions: new Set([
    "happy","joy","joyful","content","contentment","delighted","pleased","proud","grateful","gratitude","hopeful","relieved",
    "calm","relaxed","serene","peaceful","tranquil",
    "sad","sadness","unhappy","down","melancholy","blue","depressed",
    "angry","anger","annoyed","irritated","furious","frustrated","resentful",
    "afraid","fear","scared","anxious","anxiety","worried","nervous","panicked","apprehensive","dread",
    "bored","tired","weary","lethargic",
    "surprised","shocked","astonished","amazed","awe",
    "ashamed","shame","guilty","guilt","embarrassed","humiliated","mortified",
    "jealous","envy","envious","lonely","nostalgic","homesick","curious","interested","confused","disgusted",
    "compassion","empathy","sympathy","tenderness","warmth","affection","admiration","contempt","revulsion"
  ])
};

const EXT = {
  animals: new Set([
    "antelope","gazelle","springbok","eland","kudu","bongo","okapi",
    "armadillo","aardvark","aardwolf","sloth","tapir","manatee","narwhal","beluga",
    "baboon","mandrill","gibbon","marmoset","tamarin","lemur","aye aye",
    "beaver","mink","ermine","wolverine","lynx","bobcat","cougar","puma","jaguar","leopard","cheetah","panther",
    "hyena","jackal","coyote","dingo","caracal","ocelot","margay","serval","fossa",
    "bison","musk ox","saiga","pronghorn",
    "boar","peccary","tapir","capybara","agouti","paca","porcupine","hedgehog","shrew","vole",
    "ibex","tahr","musk deer","sika deer","elk","wapiti",
    "cassowary","emu","ostrich","kiwi","rhea","loon","grebe","rail","coot","moorcock",
    "ptarmigan","quail","pheasant","grouse","partridge","turaco","hoatzin","hornbill","toucan",
    "albatross","petrel","shearwater","auk","murre","guillemot","puffin","kittiwake","tern",
    "ibis","spoonbill","bittern","bustard","courser","sandgrouse","plover","lapwing","oystercatcher","avocet",
    "harrier","kestrel","merlin","hobby","goshawk","sparrowhawk","condor","caracara",
    "anole","agamid","monitor lizard","komodo dragon","skink",
    "cobra","viper","adder","rattlesnake","mamba","python","anaconda",
    "axolotl","olm","hellbender",
    "lamprey","sturgeon","paddlefish","gar","barracuda","mackerel","mahi mahi","marlin","swordfish",
    "hake","pollock","halibut","sole","plaice","flounder","ray","manta","stingray","sawfish",
    "krill","barnacle","whelk","conch","abalone","sea urchin","sea cucumber","nudibranch",
    "tarantula","trapdoor spider","black widow","scorpion","solifuge","centipede","millipede",
    "firefly","mayfly","stonefly","stick insect","mantis","cicada","locust","weevil","stag beetle",
    "silkworm","lacewing","silverfish","earwig","woodlouse","pill bug",
    "yak","water buffalo","gaur","banteng","zebu","dromedary","bactrian camel"
  ]),

  produce: new Set([
    "blood orange","seville orange","ugli fruit","yuzu","finger lime","calamansi","key lime",
    "soursop","custard apple","cherimoya","atemoya","sapodilla","sapote","mamey","feijoa",
    "tamarillo","tamarind","breadfruit","ackee","salak","snake fruit","langsat","madan","buddha hand",
    "mulberry","serviceberry","huckleberry","cloudberry","rowan","saskatoon","aronia","sea buckthorn",
    "prickly pear","cactus pear",
    "daikon","kohlrabi","celeriac","jerusalem artichoke","jicama","lotus root","taro","malanga","cassava","yuca",
    "mizuna","tatsoi","mustard greens","purslane","sorrel","mache","lamb lettuce",
    "broccolini","gai lan","choy sum",
    "chioggia beet","golden beet",
    "pasilla","ancho","guajillo","chipotle","scotch bonnet","ghost pepper","carolina reaper",
    "heirloom tomato","roma tomato","tomatillo",
    "shiitake","enoki","maitake","oyster mushroom","porcini","chanterelle","morel","ceps",
    "nori","wakame","kombu","dulse","kelp",
    "hazelnut","walnut","almond","pecan","pistachio","cashew","brazil nut","macadamia","chestnut","pine nut",
    "fenugreek","cumin","coriander seed","cardamom","clove","star anise","mustard seed","caraway","fennel seed",
    "edamame","soybean","tempeh"
  ]),

  tools: new Set([
    "impact wrench","breaker bar","nut driver","tap and die","thread chaser",
    "feeler gauge","caliper","micrometer","depth gauge","laser level","stud finder",
    "combination pliers","linesman pliers","end nipper","fencing pliers",
    "hole saw","forstner bit","spade bit","masonry bit","auger bit","countersink","deburr tool",
    "dovetail jig","mortise chisel","router bit","edge guide","featherboard","push stick",
    "bench grinder","pillar drill","drill press","lathe","band saw","scroll saw","planer","thicknesser","joiner",
    "domino joiner","biscuit joiner","pocket hole jig","nail set","bradawl","awl","center punch",
    "caulking gun","sealant","putty","joint compound","spackle",
    "workbench","sawhorse","sacrificial fence","miter gauge","sled",
    "respirator cartridge","face shield","knee pad","tool belt",
    "extension lead","power strip","cord reel",
    "multitool","oscillating tool","rotary hammer","demolition hammer"
  ]),

  jobs: new Set([
    "neurosurgeon","cardiothoracic surgeon","interventional cardiologist","intensivist","emergency physician",
    "radiologist","pathologist","endocrinologist","rheumatologist","gastroenterologist","oncologist","hematologist",
    "nephrologist","immunologist","allergist","infectious disease physician",
    "public health physician","epidemiologist","biostatistician","clinical scientist","genetic counselor",
    "occupational hygienist","health visitor","school nurse",
    "school teacher","headteacher","deputy head","principal","postdoc","research fellow","lab technician",
    "civil engineer","structural engineer","electrical engineer","mechanical engineer","chemical engineer",
    "biomedical engineer","materials scientist","industrial designer","product designer",
    "ux researcher","service designer","information architect",
    "network engineer","security analyst","penetration tester","site reliability engineer",
    "hr manager","hr assistant","recruiter","talent partner","training manager","learning designer",
    "marketing manager","brand manager","seo specialist","ppc specialist","social media manager","community manager",
    "sales manager","account manager","customer success manager","business analyst","operations manager",
    "entrepreneur","founder","ceo","cto","cfo","coo","office manager","executive assistant","personal assistant",
    "court clerk","magistrate","bailiff","probation officer","prison officer","immigration officer","customs officer",
    "town planner","urban planner","surveyor","estate agent","property manager",
    "tour guide","travel agent","concierge","hotel manager","housekeeper","sommelier","maitre d","bar manager",
    "stage manager","lighting technician","sound engineer","set designer","costume designer","makeup artist",
    "game designer","game developer","voice actor","streamer","influencer",
    "farmer","rancher","beekeeper","fisherman","forester","park ranger"
  ]),

  transport: new Set([
    "microcar","city car","liftback","fastback","hot hatch","muscle car","supercar","hypercar",
    "panel van","box truck","flatbed","tipper","cement mixer","car transporter","articulated lorry","semi trailer",
    "quad bike","atv","utv","snowmobile",
    "tram train","maglev","funicular","rack railway","heritage railway",
    "trolley","streetcar",
    "sailboard","windsurfer","paddleboard","paddle boat","pedalo",
    "hovercraft","amphibious vehicle",
    "ultralight aircraft","gyrocopter","autogyro","airship","blimp",
    "spaceplane","lander","rover","orbiter",
    "chairlift","gondola lift","cable car",
    "camel caravan","pack animal","handcart","wheelbarrow"
  ]),

  emotions: new Set([
    "elation","euphoria","glee","jubilant","triumphant","satisfaction","gratified","zest",
    "serenity","soothed","composed","equanimity",
    "irritation","agitation","indignation","outrage","wrath",
    "terror","horror","phobia","unease","misgiving","foreboding",
    "apathy","indifference","ennui","listless",
    "astonishment","bewilderment","perplexed","flummoxed",
    "revulsion","aversion","loathing","abhorrence","contemptuous",
    "homesickness","yearning","longing","pining",
    "fondness","endearment","adoration","infatuation","romantic love",
    "schadenfreude","remorse","regret","rueful","contrite",
    "gratification","appreciation","thankfulness","relief",
    "compassionate","empathetic","sympathetic","protective","tender"
  ])
};

/* Heuristics to enlarge acceptance beyond lists */
function heuristicOnTarget(cat, key, raw){
  if(cat==='animals'){
    if(/(fish|bird|whale|shark|eagle|hawk|owl|deer|wolf|bear|lion|tiger|dog|cat|horse|ant|bee|wasp|fly|bug|crab|lobster|shrimp|seal|otter|fox|duck|goose|swan|pigeon|sparrow|rat|mouse|moth|butterfly)\b/.test(key)) return true;
  }
  if(cat==='produce'){
    if(/(berry|melon|apple|pear|peach|plum|nut|bean|pea|lettuce|cabbage|onion|garlic|pepper|chili|chilli|squash|pumpkin|leaf|sprout)\b/.test(key)) return true;
  }
  if(cat==='tools'){
    if(/(wrench|screw|driver|knife|cutter|saw|pliers|drill|brush|tape|bolt|nut|ladder|spanner|clamp|level|meter|hammer)\b/.test(key)) return true;
  }
  if(cat==='jobs'){
    if(/(ist|ian|er|or|ess|man|woman|maker|worker|agent|officer|assistant|manager|technician)\b/.test(key)) return true;
  }
  if(cat==='transport'){
    if(/(car|bike|cycle|train|tram|ship|boat|plane|craft|sled|board|cart|bus|cab|taxi|van|truck|lorry|scooter|glider|raft|canoe|kayak|yacht|submarine|balloon)\b/.test(key)) return true;
  }
  if(cat==='emotions'){
    if(/(ness|ful|less|ive|ed)$/.test(key)) return true;
  }
  // allow multiword phrases like "blue whale", "city bus"
  if(/\s/.test(raw)) return true;
  return false;
}

/* ===== Strategy tips for each category ===== */
const TIPS = {
  animals: [
    "Chunk by *habitat*: land / air / water.",
    "Scan by *class*: mammals, birds, fish, reptiles, amphibians.",
    "Use *size ladders*: tiny Ã¢â€ â€™ huge (ant Ã¢â€ â€™ whale).",
    "Walk through *contexts*: farm, zoo, pet shop, safari.",
    "Alphabet walk: AÃ¢â€ â€™Z (ant, bear, catÃ¢â‚¬Â¦)."
  ],
  produce: [
    "Split fruits vs vegetables first.",
    "Group by *colour* (green, red, yellow).",
    "Group by *part*: leafy, root, seed/bean, fruiting.",
    "Walk a *supermarket aisle* in your mind.",
    "Cooking lens: salad Ã¢â€ â€™ roast/bake Ã¢â€ â€™ spices."
  ],
  tools: [
    "Divide by *task*: cutting, fastening, measuring, cleaning.",
    "Home rooms: kitchen, bathroom, shed, garage.",
    "Hand vs *power tools*.",
    "Size sequence: pocket tools Ã¢â€ â€™ large equipment.",
    "Imagine a *DIY project* step-by-step."
  ],
  jobs: [
    "Group by *sector*: health, education, construction, arts.",
    "Split by *indoor/outdoor*; *uniformed/civilian*.",
    "Think by *places*: hospital, school, airport, court, cafe.",
    "Training: apprentice Ã¢â€ â€™ professional Ã¢â€ â€™ specialist.",
    "Alphabet walk or Ã¢â‚¬Ëœday in a cityÃ¢â‚¬â„¢ scan."
  ],
  transport: [
    "Surface vs *air vs water*.",
    "Human-powered vs *motorized*.",
    "Short-trip vs *long-haul*.",
    "Public vs *private*.",
    "Visualize a *station/port/airport*."
  ],
  emotions: [
    "Valence: *pleasant vs unpleasant*.",
    "Arousal: *high vs low* (excited vs calm).",
    "Social: *self vs other* focused (proud vs jealous).",
    "Think by *situations* (exam day, reunion, conflict).",
    "Use near-synonyms but avoid exact repeats."
  ]
};

/* ===== State ===== */
let recog=null, recogActive=false, session=[];
let t0=0, timerInt=null, remaining=60, paused=false;
const els = {
  category: qs('#category'),
  duration: qs('#duration'),
  inputMode: qs('#inputMode'),
  useExtended: qs('#useExtended'),
  speechWarn: qs('#speechWarn'),
  tips: qs('#tips'),
  ok: qs('#okCount'), rep: qs('#repCount'), off: qs('#offCount'),
  timer: qs('#timer'),
  start: qs('#btnStart'), pauseBtn: qs('#btnPause'), stopBtn: qs('#btnStop'),
  exportBtn: qs('#btnExport'),
  list: qs('#list'),
  manualBox: qs('#manualBox'),
  manualInput: qs('#manualInput'),
  btnAdd: qs('#btnAdd'),
  notes: qs('#notes'),
  groups: qs('#groups')
};

function qs(s,root=document){return root.querySelector(s)}
function norm(w){
  return w.toLowerCase()
    .replace(/[^a-zA-Z\u00C0-\u024F\s\-']/g,'')
    .trim()
    .replace(/\s+/g,' ')
    .replace(/'s\b/,'')
    .replace(/s\b/,''); // simple singularize
}
function splitWords(text){
  const parts = text.split(/[,\n;]+/).map(s=>s.trim()).filter(Boolean);
  if (parts.length>1) return parts;
  return text.split(/\s+/).map(s=>s.trim()).filter(Boolean);
}

function setTips(cat){ els.tips.innerHTML = TIPS[cat].map(x=>`<li>${x}</li>`).join(''); }
setTips(els.category.value);
els.category.addEventListener('change',()=>setTips(els.category.value));

/* Speech availability */
const canSpeech = 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;
if(!canSpeech){ els.speechWarn.style.display='block'; }
els.inputMode.addEventListener('change', ()=>{
  els.manualBox.style.display = (els.inputMode.value==='manual')?'block':'none';
});

/* Buttons */
els.start.addEventListener('click', startSession);
els.pauseBtn.addEventListener('click', togglePause);
els.stopBtn.addEventListener('click', stopSession);
els.exportBtn.addEventListener('click', exportCSV);
els.btnAdd.addEventListener('click', ()=>addManual(els.manualInput.value));
els.manualInput.addEventListener('keydown', e=>{ if(e.key==='Enter'){addManual(els.manualInput.value)} });

function startSession(){
  resetSession();
  remaining = parseInt(els.duration.value,10);
  els.timer.textContent = remaining;
  t0 = performance.now();
  timerInt = setInterval(tick, 1000);
  els.start.disabled = true;
  els.pauseBtn.disabled = false;
  els.stopBtn.disabled = false;
  els.exportBtn.disabled = true;
  els.groups.innerHTML = ''; // clear previous grouping
  if(els.inputMode.value==='speech'){
    if(!canSpeech){ alert('Speech not supported here. Switch to Manual input.'); return; }
    startRecog();
  }else{
    els.manualInput.focus();
  }
}

function togglePause(){
  if(paused){
    t0 = performance.now() - ( (parseInt(els.duration.value,10) - remaining) * 1000 );
    timerInt = setInterval(tick,1000);
    if(recog && !recogActive) try{recog.start();recogActive=true;}catch{}
    paused=false; els.pauseBtn.textContent='Pause';
  }else{
    clearInterval(timerInt);
    if(recog && recogActive) { try{recog.stop();}catch{} recogActive=false; }
    paused=true; els.pauseBtn.textContent='Resume';
  }
}

function stopSession(){
  clearInterval(timerInt);
  if(recog && recogActive) { try{recog.stop()}catch{} recogActive=false; }
  els.start.disabled=false; els.pauseBtn.disabled=true; els.stopBtn.disabled=true; els.exportBtn.disabled=false;
  // Build strategy grouping view
  renderGroups();
}

function tick(){
  if(paused) return;
  remaining--;
  els.timer.textContent = remaining;
  if(remaining<=0){ stopSession(); }
}

/* Speech Recognition */
function startRecog(){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  recog = new SR();
  recog.lang = 'en-GB';
  recog.interimResults = true;
  recog.continuous = true;
  recog.onresult = (e)=>{
    let finalText='';
    for(let i=e.resultIndex;i<e.results.length;i++){
      const res = e.results[i];
      if(res.isFinal){ finalText += res[0].transcript + ' '; }
    }
    if(finalText.trim()){ handleInput(finalText); }
  };
  recog.onend = ()=>{ if(!paused && remaining>0){ try{recog.start();}catch{} } else { recogActive=false; } };
  try{ recog.start(); recogActive=true; }catch{}
}

/* Input handling */
function addManual(text){
  if(!text.trim())return;
  handleInput(text);
  els.manualInput.value='';
  els.manualInput.focus();
}

function handleInput(text){
  const cat = els.category.value;
  splitWords(text).forEach(token=>{
    const clean = norm(token);
    if(!clean) return;
    recordWord(cat, clean, token);
  });
}

function recordWord(cat, key, raw){
  const t = Math.max(0, (performance.now()-t0)/1000);
  const isRepeat = session.some(it=>it.key===key && !it.deleted);
  const onTarget = checkOnTarget(cat, key, raw);
  const item = { cat, ts: t, raw, key, repeat:isRepeat, onTarget, overrideApproved:false, deleted:false };
  session.push(item);
  renderItem(item, session.length-1);
  refreshCounts();
}

function checkOnTarget(cat, key, raw){
  const base = BASE[cat]; const ext = EXT[cat]; const useExt = els.useExtended.checked;
  if(base.has(key) || base.has(raw.toLowerCase())) return true;
  if(useExt && (ext.has(key) || ext.has(raw.toLowerCase()))) return true;
  // heuristics widen acceptance
  if(useExt && heuristicOnTarget(cat, key, raw)) return true;
  return false;
}

/* Render list */
function renderItem(item, idx){
  const row = document.createElement('div');
  row.className='grid item';
  row.dataset.idx = idx;
  row.innerHTML = `
    <div class="mono">+${item.ts.toFixed(1)}s</div>
    <div class="word">${escapeHtml(item.raw)}</div>
    <div>${statusLabel(item)}</div>
    <div><label class="small"><input type="checkbox" ${item.overrideApproved?'checked':''}/> Approve</label></div>
    <div><button class="ghost smallBtn">Remove</button></div>
  `;
  row.querySelector('input').addEventListener('change', (e)=>{
    item.overrideApproved = e.target.checked;
    row.children[2].innerHTML = statusLabel(item);
    refreshCounts();
  });
  row.querySelector('button').addEventListener('click', ()=>{
    item.deleted = true; row.remove(); refreshCounts();
  });
  els.list.prepend(row);
}
function statusLabel(item){
  const tags=[];
  if(item.deleted){ return `<span class="small">Ã¢â‚¬â€</span>`; }
  if(item.repeat) tags.push(`<span class="tag rep">repeat</span>`);
  const off = (!item.onTarget && !item.overrideApproved);
  if(off) tags.push(`<span class="tag off">off-target</span>`);
  if(!off && !item.repeat) tags.push(`<span class="tag ok">ok</span>`);
  return tags.join(' ');
}
function refreshCounts(){
  let ok=0, rep=0, off=0;
  session.forEach(it=>{
    if(it.deleted) return;
    const offNow = (!it.onTarget && !it.overrideApproved);
    if(it.repeat) rep++;
    if(offNow) off++;
    if(!it.repeat && !offNow) ok++;
  });
  els.ok.textContent = ok; els.rep.textContent = rep; els.off.textContent = off;
}

/* Strategy Grouping (post-session) */
function renderGroups(){
  const cat = els.category.value;
  // Consider only active, accepted items (repeat allowed but we list unique surface forms)
  const items = session.filter(it=>!it.deleted && (it.onTarget || it.overrideApproved));
  const unique = new Map(); // key -> raw (first)
  items.forEach(it=>{ if(!unique.has(it.key)) unique.set(it.key, it.raw); });

  const buckets = categorizeByStrategy(cat, Array.from(unique.keys()));
  const container = els.groups;
  container.innerHTML = '';
  for(const [groupTitle, arr] of Object.entries(buckets)){
    const words = arr.map(k=>unique.get(k)).filter(Boolean);
    const div = document.createElement('div');
    div.className='grp';
    div.innerHTML = `<h4>${escapeHtml(groupTitle)}</h4>` + (words.length
      ? words.map(w=>`<span class="pill">${escapeHtml(w)}</span>`).join(' ')
      : `<div class="small">Ã¢â‚¬â€</div>`);
    container.appendChild(div);
  }
}

/* Category-specific grouping rules */
function categorizeByStrategy(cat, keys){
  const out = {};
  function put(bucket, key){ (out[bucket]??=[]).push(key); }
  function ensure(names){ names.forEach(n=>{ if(!(n in out)) out[n]=[]; }); }

  if(cat==='animals'){
    ensure(["Mammals","Birds","Fish","Reptiles","Amphibians","Invertebrates","Other/Unclassified"]);
    keys.forEach(k=>{
      if(/(dog|cat|horse|cow|sheep|goat|pig|rabbit|mouse|rat|hamster|guinea pig|elephant|lion|tiger|bear|wolf|fox|deer|giraffe|zebra|monkey|gorilla|chimpanzee|orangutan|panda|koala|kangaroo|camel|hippo|rhino|bison|buffalo|yak|moose|reindeer|donkey|mule|boar|sloth|armadillo|tapir|antelope|gazelle|ibex|otter|badger|hedgehog|weasel|ferret|skunk|raccoon|mole|bat|whale|dolphin|porpoise|seal|sea lion|walrus|manatee|dugong)\b/.test(k)){ put("Mammals",k); return; }
      if(/(eagle|hawk|falcon|owl|vulture|buzzard|kite|parrot|macaw|cockatoo|parakeet|pigeon|dove|sparrow|finch|robin|blackbird|thrush|swallow|swift|magpie|jay|crow|raven|stork|heron|egret|pelican|cormorant|kingfisher|woodpecker|duck|goose|swan|turkey|chicken|rooster|hen|ostrich|emu|cassowary|kiwi|albatross|petrel|puffin|grebe|loon|quail|pheasant|grouse|partridge)\b/.test(k)){ put("Birds",k); return; }
      if(/(shark|salmon|tuna|cod|trout|herring|sardine|anchovy|carp|pike|eel|sturgeon|mackerel|marlin|swordfish|halibut|flounder|plaice|ray|manta|stingray)\b/.test(k)){ put("Fish",k); return; }
      if(/(snake|python|boa|viper|cobra|adder|mamba|lizard|gecko|iguana|chameleon|monitor|komodo dragon|crocodile|alligator|turtle|tortoise)\b/.test(k)){ put("Reptiles",k); return; }
      if(/(frog|toad|salamander|newt|axolotl)\b/.test(k)){ put("Amphibians",k); return; }
      if(/(ant|bee|wasp|hornet|termite|beetle|ladybird|butterfly|moth|dragonfly|grasshopper|cricket|spider|scorpion|snail|slug|worm|octopus|squid|cuttlefish|jellyfish|crab|lobster|shrimp|prawn|barnacle|urchin|sea cucumber)\b/.test(k)){ put("Invertebrates",k); return; }
      put("Other/Unclassified",k);
    });
    return out;
  }

  if(cat==='produce'){
    ensure(["Fruits","Vegetables","Leafy greens","Roots/Tubers","Beans/Legumes/Seeds","Other/Unclassified"]);
    keys.forEach(k=>{
      if(/(apple|pear|banana|plantain|orange|mandarin|tangerine|grapefruit|lemon|lime|kumquat|peach|nectarine|apricot|plum|cherry|grape|raisin|currant|berry|kiwi|mango|papaya|pineapple|passionfruit|pomegranate|fig|date|olive|avocado|melon|watermelon|persimmon|guava|lychee|longan|rambutan|dragonfruit|starfruit|jackfruit|durian|custard apple|soursop)\b/.test(k)){ put("Fruits",k); return; }
      if(/(tomato|potato|sweet potato|yam|carrot|parsnip|turnip|swede|beet|radish|onion|shallot|leek|garlic|ginger|turmeric|cabbage|kale|chard|spinach|lettuce|endive|radicchio|rocket|watercress|bok choy|broccoli|cauliflower|sprout|cucumber|courgette|zucchini|pumpkin|squash|pepper|chili|aubergine|eggplant|okra|celery|fennel|artichoke|asparagus|corn|mushroom|seaweed)\b/.test(k)){ put("Vegetables",k); return; }
      if(/(lettuce|cabbage|kale|chard|spinach|endive|radicchio|rocket|watercress|bok choy|pak choi|mizuna|tatsoi|mustard greens)\b/.test(k)){ put("Leafy greens",k); return; }
      if(/(carrot|parsnip|turnip|beet|radish|yam|sweet potato|cassava|yuca|taro|jerusalem artichoke|lotus root)\b/.test(k)){ put("Roots/Tubers",k); return; }
      if(/(pea|bean|lentil|chickpea|soybean|edamame|seed|nut)\b/.test(k)){ put("Beans/Legumes/Seeds",k); return; }
      put("Other/Unclassified",k);
    });
    return out;
  }

  if(cat==='tools'){
    ensure(["Cutting","Fastening","Measuring/Marking","Power tools","Cleaning/Household","Safety/Consumables","Other/Unclassified"]);
    keys.forEach(k=>{
      if(/(knife|scissors|cutter|saw|chisel|plane|spokeshave|rasp|file|snips|shears)\b/.test(k)){ put("Cutting",k); return; }
      if(/(screw|screwdriver|wrench|spanner|socket|ratchet|torque|allen|hex|pliers|clamp|vice|nail|hammer|staple|bolt|nut)\b/.test(k)){ put("Fastening",k); return; }
      if(/(tape measure|ruler|square|level|plumb|protractor|caliper|micrometer|gauge)\b/.test(k)){ put("Measuring/Marking",k); return; }
      if(/(drill|driver|grinder|sander|router|lathe|planer|nailer|staple gun|rotary tool|dremel|soldering iron)\b/.test(k)){ put("Power tools",k); return; }
      if(/(broom|brush|mop|bucket|vacuum|iron|kettle|toaster|microwave|oven|spatula|whisk|ladle|tongs|peeler|grater|colander|sieve|measuring cup|jug|pan|pot)\b/.test(k)){ put("Cleaning/Household",k); return; }
      if(/(mask|goggle|glasses|earplug|respirator|glove|tape|glue|epoxy|sealant)\b/.test(k)){ put("Safety/Consumables",k); return; }
      put("Other/Unclassified",k);
    });
    return out;
  }

  if(cat==='jobs'){
    ensure(["Health","Education/Research","Trades/Construction","Tech/Business","Law/Gov/Emergency","Arts/Media","Hospitality/Retail","Other/Unclassified"]);
    keys.forEach(k=>{
      if(/(doctor|physician|surgeon|nurse|midwife|paramedic|psychologist|psychiatrist|therapist|pharmacist|dentist|optometrist|ophthalmologist|podiatrist|dietitian|anesthesiologist|neurologist|cardiologist|urologist|dermatologist|gp|occupational therapist|physiotherapist|radiographer|speech therapist)\b/.test(k)){ put("Health",k); return; }
      if(/(teacher|lecturer|professor|researcher|scientist|librarian|postdoc|fellow|student)\b/.test(k)){ put("Education/Research",k); return; }
      if(/(electrician|plumber|carpenter|joiner|bricklayer|roofer|painter|decorator|tiler|builder|mechanic|welder|machinist)\b/.test(k)){ put("Trades/Construction",k); return; }
      if(/(software engineer|developer|programmer|data scientist|analyst|statistician|architect|designer|manager|accountant|banker|trader|entrepreneur|ceo|cto|cfo)\b/.test(k)){ put("Tech/Business",k); return; }
      if(/(lawyer|barrister|solicitor|judge|clerk|civil servant|diplomat|police|officer|firefighter|paramedic|prison|probation)\b/.test(k)){ put("Law/Gov/Emergency",k); return; }
      if(/(artist|musician|singer|actor|journalist|editor|photographer|filmmaker|producer|director|designer|writer|illustrator)\b/.test(k)){ put("Arts/Media",k); return; }
      if(/(chef|cook|baker|butcher|barista|bartender|waiter|waitress|receptionist|cashier|shop|sales|retail|porter|cleaner|security|concierge|tour guide)\b/.test(k)){ put("Hospitality/Retail",k); return; }
      put("Other/Unclassified",k);
    });
    return out;
  }

  if(cat==='transport'){
    ensure(["Road","Rail","Water","Air/Space","Human/Animal powered","Other/Unclassified"]);
    keys.forEach(k=>{
      if(/(car|hatchback|sedan|saloon|estate|wagon|van|minivan|pickup|truck|lorry|bus|coach|taxi|cab|motorbike|motorcycle|scooter|moped|quad|atv|utv|snowmobile)\b/.test(k)){ put("Road",k); return; }
      if(/(train|tram|monorail|subway|underground|metro|trolleybus|funicular|rack railway|maglev|light rail)\b/.test(k)){ put("Rail",k); return; }
      if(/(boat|ship|ferry|canoe|kayak|rowboat|dinghy|yacht|sailboat|catamaran|gondola|barge|hydrofoil|submarine|hovercraft)\b/.test(k)){ put("Water",k); return; }
      if(/(plane|airplane|aeroplane|jet|biplane|seaplane|glider|helicopter|dirigible|zeppelin|airship|hot air balloon|rocket|spaceship|space shuttle|drone|capsule|lander|rover)\b/.test(k)){ put("Air/Space",k); return; }
      if(/(bicycle|bike|tricycle|rollerblades|skateboard|scooter|rickshaw|tuk|camel|horse|dogsled|wheelbarrow|handcart)\b/.test(k)){ put("Human/Animal powered",k); return; }
      put("Other/Unclassified",k);
    });
    return out;
  }

  if(cat==='emotions'){
    ensure(["Positive","Negative","High arousal","Low arousal","Social/Relational","Other/Unclassified"]);
    keys.forEach(k=>{
      if(/(happy|joy|content|delight|pleased|proud|grateful|hopeful|relieved|serene|peaceful|calm|tranquil|elation|euphoria|satisfaction|gratified)\b/.test(k)){ put("Positive",k); }
      if(/(sad|unhappy|melancholy|depressed|angry|annoyed|irritated|furious|resentful|afraid|scared|anxious|worried|nervous|bored|tired|ashamed|guilty|embarrassed|lonely|jealous|envious|nostalgic|homesick|disgusted|contemptuous|aversion|loathing|outrage|indignation)\b/.test(k)){ put("Negative",k); }
      if(/(excited|angry|furious|afraid|anxious|worried|irritated|euphoria|elation|panic|astonished|amazed|awe|outrage)\b/.test(k)){ put("High arousal",k); }
      if(/(calm|relaxed|serene|peaceful|tranquil|tired|bored|melancholy|content)\b/.test(k)){ put("Low arousal",k); }
      if(/(proud|guilty|ashamed|jealous|envy|compassion|empathy|sympathy|affection|admiration|tenderness|warmth|love|hate|contempt)\b/.test(k)){ put("Social/Relational",k); }
      if(!(out["Positive"].includes(k)||out["Negative"].includes(k)||out["High arousal"].includes(k)||out["Low arousal"].includes(k)||out["Social/Relational"].includes(k))){ put("Other/Unclassified",k); }
    });
    return out;
  }

  return {"Other/Unclassified": keys};
}

/* Export CSV */
function exportCSV(){
  const cat = els.category.value;
  const lines = [['category','duration_s','timestamp_rel_s','raw','normalized','repeat','off_target','override','deleted','notes'].join(',')];
  const notes = JSON.stringify(els.notes.value||'').replace(/"/g,'""');
  const dur = parseInt(els.duration.value,10);
  session.forEach(it=>{
    const offNow = (!it.onTarget && !it.overrideApproved);
    lines.push([
      cat, dur, it.ts.toFixed(2),
      csvEsc(it.raw), csvEsc(it.key),
      it.repeat ? 1:0,
      offNow ? 1:0,
      it.overrideApproved ? 1:0,
      it.deleted ? 1:0,
      `"${notes}"`
    ].join(','));
  });
  const blob = new Blob([lines.join('\n')],{type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download=`fluency_${cat}_${Date.now()}.csv`; document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}

/* Utils */
function escapeHtml(s){return s.replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]))}
function csvEsc(s){ if(s==null)return ''; const t=String(s).replace(/"/g,'""'); return `"${t}"`; }
function resetSession(){
  session=[]; els.list.innerHTML='';
  els.ok.textContent='0'; els.rep.textContent='0'; els.off.textContent='0';
  els.groups.innerHTML='';
  clearInterval(timerInt); paused=false; els.pauseBtn.textContent='Pause';
}

/* Init */
(function init(){
  if(!canSpeech){ els.inputMode.value='manual'; els.manualBox.style.display='block'; }
})();
</script>
<section id="clinician-notes">
<div style="background: var(--surface); border: 1px solid var(--line); border-radius: 12px; box-shadow: var(--shadow); padding: 16px; margin-top: 24px;">
<label for="clinician-comment" style="display:block;font-weight:600;margin-bottom:8px;">
      Clinician comments (optional)
    </label>
<textarea id="clinician-comment" placeholder="Enter any notes relevant to this session..." rows="4" style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--line); font: inherit; resize: vertical;"></textarea>
<p style="margin:8px 0 0; color: var(--muted); font-size: 0.9rem;">
      This note will be added as <code>clinician_comment</code> in the exported CSV.
    </p>
</div>
</section></main></body>
</html>

