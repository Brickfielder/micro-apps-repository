<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>

  <title>Travel with Coco ‚Äî Milestones </title>

  <!-- Micro-Apps shared assets (published at site root) -->
  <link rel="stylesheet" href="/micro-apps-repository/shared/theme.css?v=3">
  <script defer src="/micro-apps-repository/shared/frame.js?v=3"></script>
  <script defer src="/micro-apps-repository/shared/clinician_feedback.js?v=3"></script>

  <!-- Frame metadata (hero title/desc via catalog.json or explicit overrides) -->
  <meta name="app-slug" content="travel-with-coco">
  <meta name="app-title" content="Travel with Coco ‚Äî Milestones">
  <meta name="app-desc" content="Plan a journey with your cheeky companion. Reach your destination city before you run out of resources.">

  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --text:#111827; --muted:#6b7280;
      --brand:#2563eb; --brand-2:#7c3aed; --ok:#16a34a; --warn:#b45309; --danger:#dc2626;
      --border:#e5e7eb; --pill:#f3f4f6; --chip:#eef2ff; --shadow:0 12px 30px rgba(17,24,39,0.08);
    }
    .dash{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:4px}
    .tile{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px;box-shadow:var(--shadow)}
    .tile .label{font-size:12px;color:var(--muted)}
    .tile .value{font-weight:800;letter-spacing:.2px}
    .value.bad{color:var(--danger)} .value.warn{color:var(--warn)} .value.good{color:var(--ok)}

    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);padding:18px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end}
    .btn{appearance:none;border:1px solid var(--border);background:#fff;border-radius:12px;padding:12px 14px;
         font-size:15px;cursor:pointer;transition:.15s box-shadow,.15s transform;box-shadow:0 2px 0 rgba(0,0,0,.04)}
    .btn:hover{box-shadow:0 10px 20px rgba(0,0,0,.08);transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .btn.primary{background:linear-gradient(135deg,var(--brand),var(--brand-2));border-color:transparent;color:#fff}
    .btn.ghost{background:transparent}
    .btn.chip{background:var(--chip);border-color:#e9e5ff}

    .choice{display:flex;gap:12px;border:1px dashed var(--border);border-radius:16px;padding:14px;margin:12px 0;background:#fbfcff}
    .choice h4{margin:0 0 4px}
    .choice small{color:var(--muted)}
    .hr{height:1px;background:var(--border);margin:16px 0}
    .muted{color:var(--muted)}

    .progress{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.04)}
    .chip.done{background:#ecfdf5;border-color:#d1fae5}
    .chip.current{background:#eff6ff;border-color:#dbeafe}

    .toolbar{display:flex;align-items:center;gap:10px;justify-content:space-between;margin-top:8px}

    @media (max-width:860px){ .dash{grid-template-columns:repeat(2,1fr)} }
    @media (max-width:520px){ .row label{width:100%} }
  </style>
</head>

<body>
  <!-- frame.js wraps this in .app-wrap and injects the .app-hero above -->
  <main id="app-root" aria-live="polite">
    <!-- Dashboard tiles -->
    <section class="dash" aria-label="Trip dashboard">
      <div class="tile"><div class="label">üí∞ Money</div><div class="value" id="moneyVal">‚Äî</div></div>
      <div class="tile"><div class="label">‚è≥ Time left (days)</div><div class="value" id="timeVal">‚Äî</div></div>
      <div class="tile"><div class="label">üîã Energy</div><div class="value" id="energyVal">‚Äî</div></div>
      <div class="tile"><div class="label">üê¶ Coco‚Äôs Mood</div><div class="value" id="moodVal">‚Äî</div></div>
    </section>

    <!-- App content -->
    <section id="app"></section>
  </main>

  <script>
    // ----------------------
    // Game State v0.3 ‚Äî Presets + CSV + Sleek UI
    // ----------------------
    const ROUTE_PRESETS = {
      'UK ‚Üí Italy (City Hop)': ['London','Paris','Milan','Florence','Rome'],
      'Japan Golden Route': ['Tokyo','Hakone','Kyoto','Osaka'],
      'US West Coast': ['Seattle','Portland','San Francisco','Los Angeles','San Diego'],
      'Alps Highlights': ['Geneva','Chamonix','Aosta','Zermatt','St. Moritz']
    };

    const game = {
      phase: 'start',
      day: 1,
      routeCities: [...ROUTE_PRESETS['UK ‚Üí Italy (City Hop)']],
      routeIndex: 0,
      money: 200,
      time: 5,
      energy: 100,
      mood: 50,
      followedCocoCount: 0,
      ignoredCocoCount: 0,
      log: [],
      lastCoco: null,
      csvRows: [],
      todayTimeDelta: 0 // <-- travel's extra/saved time for this day (relative to baseline 1)
    };

    // Derived
    const startCity = ()=> game.routeCities[0];
    const destination = ()=> game.routeCities[game.routeCities.length-1];
    const currentCity = ()=> game.routeCities[game.routeIndex];
    const nextCity = (advance=1)=> game.routeCities[Math.min(game.routeIndex+advance, game.routeCities.length-1)];

    // Utils
    const clamp = (n,min,max)=>Math.max(min,Math.min(max,n));
    const chance = p => Math.random() < p;
    const pick = arr => arr[Math.floor(Math.random()*arr.length)];
    const app = document.getElementById('app');
    const html = (s,...v)=>s.map((x,i)=>x+(v[i]??'')).join('');

    // Dashboard
    function updateDash(){
      const money = document.getElementById('moneyVal');
      const time  = document.getElementById('timeVal');
      const energy= document.getElementById('energyVal');
      const mood  = document.getElementById('moodVal');
      const set = (el,val)=>{ el.textContent=val; el.className='value'; if(+val<=0) el.classList.add('bad'); };
      set(money, `¬£${game.money}`); set(time, `${game.time}`); set(energy, `${game.energy}`); set(mood, `${game.mood}`);
      if(game.energy>=70) energy.classList.add('good'); else if(game.energy<=30) energy.classList.add('warn');
      if(game.money<=20) money.classList.add('warn'); if(game.time<=1) time.classList.add('warn');
      if(game.mood>=80) mood.classList.add('good'); else if(game.mood<20) mood.classList.add('warn');
    }

    // Progress UI
    function progressBar(){
      return `<div class="progress">${
        game.routeCities.map((c,i)=>{
          const cls = i<game.routeIndex? 'chip done' : (i===game.routeIndex? 'chip current':'chip');
          const dot = i<game.routeIndex? '‚úÖ' : (i===game.routeIndex? 'üîµ':'‚ö™');
          return `<span class="${cls}">${dot} <span>${c}</span></span>`;
        }).join('<span class="muted">‚Üí</span>')
      }</div>`;
    }

    // Options (use timeDelta relative to baseline of 1 day)
    function genCocoSuggestion(){
      if(game.mood<20) return null;
      let sensibleP=0.2, whimsicalP=0.5, luckyP=0.2, sabotageP=0.1;
      if(game.mood>80){ sensibleP=0.3; luckyP=0.3; whimsicalP=0.3; sabotageP=0.1; }
      const r=Math.random();
      let type='whimsical';
      if(r<sensibleP) type='sensible';
      else if(r<sensibleP+whimsicalP) type='whimsical';
      else if(r<sensibleP+whimsicalP+luckyP) type='lucky';
      else type='sabotage';

      let advance=1, cost=0, energy=0, timeCost=1, detail='Coco has a plan‚Ä¶';
      if(type==='sensible'){ advance=1; cost=-50; energy=-8;  timeCost=1; detail='‚ÄúLet‚Äôs grab a cheap regional train.‚Äù'; }
      else if(type==='whimsical'){ advance=1; cost=-40; energy=-22; timeCost=2; detail='‚ÄúRent a tandem bike across the hills!‚Äù'; }
      else if(type==='lucky'){ advance=2; cost=0;   energy=-8;  timeCost=1; detail='‚ÄúFree carpool! We can skip a stop.‚Äù'; }
      else { advance=0; cost=-20; energy=-15; timeCost=1; detail='‚ÄúQuick detour to see a giant spoon!‚Äù (doesn‚Äôt advance)'; }
      const target = nextCity(advance);
      return {
        key:'coco',
        label:`Follow Coco ‚Üí ${target}`,
        detail,
        cost, energy,
        timeDelta: timeCost - 1, // convert to delta from the baseline 1 day
        advance, type
      };
    }

    function baseTravelOptions(){
      const jump2 = Math.min(2, game.routeCities.length-1 - game.routeIndex);
      return [
        { key:'flight', label:`‚úàÔ∏è Flight ‚Üí ${nextCity(jump2)}`, detail:'-¬£120, -20 energy, saves a day', cost:-120, energy:-20, timeDelta:-1, advance:jump2 },
        { key:'train',  label:`üöÜ Train ‚Üí ${nextCity(1)}`,      detail:'-¬£70, -10 energy, 1 day',        cost:-70,  energy:-10, timeDelta: 0, advance:1 },
        { key:'bus',    label:`üöå Bus ‚Üí ${nextCity(1)}`,        detail:'-¬£30, -15 energy, 1 day',        cost:-30,  energy:-15, timeDelta: 0, advance:1 },
        { key:'walk',   label:`üö∂ Walk ‚Üí ${nextCity(1)}`,       detail:'¬£0, -25 energy, 2 days',         cost:  0,  energy:-25, timeDelta:+1, advance:1 },
      ];
    }

    const stayOptions = [
      { key:'hotel',  label:'üè® Hotel',    cost:-80, energy:+30, mood:0,  detail:'-¬£80, +30 energy' },
      { key:'hostel', label:'üõèÔ∏è Hostel',   cost:-40, energy:+20, mood:0,  detail:'-¬£40, +20 energy' },
      { key:'camp',   label:'‚õ∫ Camping',  cost:-10, energy:+10, mood:-5, detail:'-¬£10, +10 energy, -5 mood' },
      { key:'nosleep',label:'üòµ No sleep', cost:  0, energy:-10, mood:-10,detail:'¬£0, -10 energy, -10 mood' },
    ];

    const foodOptions = [
      { key:'restaurant', label:'üçΩÔ∏è Restaurant', cost:-30, energy:+15, mood:+5, detail:'-¬£30, +15 energy, +5 mood' },
      { key:'fast',       label:'üçî Fast food',  cost:-15, energy:+10, mood: 0, detail:'-¬£15, +10 energy' },
      { key:'snack',      label:'ü•® Snacks',     cost: -5, energy: +5, mood: 0, detail:'-¬£5, +5 energy' },
      { key:'nomeal',     label:'üö´ No meal',    cost:  0, energy:-10, mood:-5, detail:'¬£0, -10 energy, -5 mood' },
    ];

    // Random event
    function randomEvent(){
      if(!chance(0.2)) return null;
      const events = [
        { label:'Lost item',      effect:()=>{ game.money=Math.max(0,game.money-20);         return 'You lost an item: -¬£20.'; } },
        { label:'Friendly local', effect:()=>{ game.energy=clamp(game.energy+20,0,100);      return 'A friendly local hosted you: +20 energy.'; } },
        { label:'Illness',        effect:()=>{ game.energy=Math.max(0,game.energy-15);       return 'You felt unwell today: -15 energy.'; } },
        { label:'Festival',       effect:()=>{ game.money=Math.max(0,game.money-15); game.mood=clamp(game.mood+10,0,100); return 'Festival day! -¬£15, +10 mood.'; } },
        { label:'Scam',           effect:()=>{ game.money=Math.max(0,game.money-30);         return 'Oops, a travel scam: -¬£30.'; } },
        { label:'Shortcut',       effect:()=>{ game.time=Math.max(0,game.time+1);            return 'You discovered a shortcut: +1 day.'; } },
      ];
      return pick(events);
    }

    // CSV export ‚Äî ensure a[download] so clinician_feedback can augment the file
    function exportCSV(){
      const header = ['Day','Phase','Action','From','To','Money','Time','Energy','Mood'];
      const rows = [header, ...game.csvRows];
      const csv = rows.map(r=>r.map(x=>`"${String(x).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'travel_with_coco_log.csv';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    // Screens
    function screenStart(){
      const presetOptions = Object.keys(ROUTE_PRESETS).map(name=>`<option value="\${name}">\${name}</option>`).join('');
      app.innerHTML = html`
        <div class="card">
          <h2>Set up your journey</h2>
          <div class="row" style="gap:8px;">
            <label>Choose a preset<br>
              <select id="presetSel" class="btn chip">\${presetOptions}</select>
            </label>
            <label>or edit milestones (comma-separated)<br>
              <input id="routeStr" style="min-width:520px" value="\${game.routeCities.join(', ')}" aria-label="Route cities">
            </label>
            <label>Days<br><input id="days" type="number" min="3" max="20" value="\${game.time}" aria-label="Time in days"></label>
            <label>Money (¬£)<br><input id="cash" type="number" min="50" max="1000" value="\${game.money}" aria-label="Starting money"></label>
          </div>
          <div class="toolbar">
            <div class="muted">First city = start ‚Ä¢ Last city = destination</div>
            <div class="right"><button class="btn primary" id="startBtn">Start Game</button></div>
          </div>
        </div>
      `;
      const presetSel = document.getElementById('presetSel');
      presetSel.value = 'UK ‚Üí Italy (City Hop)';
      presetSel.onchange = ()=>{
        const name = presetSel.value; game.routeCities = [...ROUTE_PRESETS[name]];
        document.getElementById('routeStr').value = game.routeCities.join(', ');
      };
      document.getElementById('startBtn').onclick = ()=>{
        const parts = (document.getElementById('routeStr').value||'').split(',').map(s=>s.trim()).filter(Boolean);
        if(parts.length>=2){ game.routeCities = parts; }
        game.routeIndex = 0; game.day = 1; game.csvRows = [];
        game.time = parseInt(document.getElementById('days').value)||5;
        game.money = parseInt(document.getElementById('cash').value)||200;
        game.energy = 100; game.mood = 50;
        game.phase='travel';
        game.todayTimeDelta = 0;
        game.log = [{type:'start', msg:`Start at ${startCity()} ‚Üí ${destination()}`}];
        updateDash();
        screenTravel();
      };
    }

    function screenTravel(){
      if(checkEnd()) return;
      const options = baseTravelOptions();
      const coco = genCocoSuggestion();
      game.lastCoco = coco;
      game.todayTimeDelta = 0; // reset until a choice is made

      app.innerHTML = html`
        <div class="card">
          <div class="toolbar">
            <div>\${progressBar()}</div>
            <div class="right"><button class="btn chip" id="btnExport">‚¨áÔ∏è Download CSV</button></div>
          </div>
          <h2 style="margin-top:8px">Day \${game.day} ‚Äî Travel choices</h2>
          <p><strong>Current:</strong> \${currentCity()} ‚Üí <strong>Goal:</strong> \${destination()}</p>

          <!-- Coco FIRST -->
          <div class="choice" \${!coco?'aria-disabled="true"':''} style="border:2px solid #dbeafe;background:#eff6ff">
            <div>üê¶</div>
            <div>
              <h4 style="margin:0 0 6px 0">Coco says:</h4>
              <div>\${coco ? coco.detail : '<em>Coco is sulking‚Ä¶ no suggestions today.</em>'}</div>
              \${coco ? html`<small class="muted">Effect if followed: \${fmtTravel(coco)}</small>` : ''}
              \${coco ? html`<div style="margin-top:8px" class="row"><button class="btn" id="btnCoco">\${coco.label}</button></div>` : ''}
            </div>
          </div>

          <div class="hr"></div>
          <h3 style="margin-top:0">Other options</h3>
          <div id="choices"></div>
        </div>
      `;

      document.getElementById('btnExport').onclick = exportCSV;

      const list = document.getElementById('choices');
      options.forEach(o=>{
        const div = document.createElement('div');
        div.className='choice';
        div.innerHTML = `
          <div>üß≠</div>
          <div>
            <h4>\${o.label}</h4>
            <div>\${o.detail}</div>
            <small class="muted">Effect: \${fmtTravel(o)}</small>
            <div style="margin-top:8px" class="row"><button class="btn" data-key="\${o.key}">Choose \${o.label}</button></div>
          </div>`;
        list.appendChild(div);
      });

      list.querySelectorAll('button[data-key]').forEach(btn=>{
        btn.onclick = ()=>applyTravel(options.find(o=>o.key===btn.dataset.key), false);
      });
      if(coco){ document.getElementById('btnCoco').onclick = ()=>applyTravel(coco,true); }
    }

    function fmtTravel(o){
      const toCity = nextCity(o.advance||1);
      const daysNum = 1 + (o.timeDelta||0); // baseline 1 day + delta
      const days = `${daysNum} day${daysNum!==1?'s':''}`;
      const cost = `${(o.cost||0) < 0 ? (o.cost) : '+'+(o.cost||0)}¬£`;
      const energy = (o.energy||0);
      return `${cost}, ${energy} energy, ${days}, ‚Üí ${toCity}`;
    }

    function pushCsvRow(phase, action, from, to){
      game.csvRows.push([game.day, phase, action, from, to, game.money, game.time, game.energy, game.mood]);
    }

    function applyTravel(opt, isCoco){
      if(game.lastCoco){
        if(isCoco){ game.mood = clamp(game.mood+10,0,100); game.followedCocoCount++; }
        else { game.mood = clamp(game.mood-5,0,100); game.ignoredCocoCount++; }
      }
      const priorCity = currentCity();
      game.money = Math.max(0, game.money + (opt.cost||0));
      game.energy = clamp(game.energy + (opt.energy||0), 0, 100);
      // DO NOT subtract time here ‚Äî we do it once at end-of-day
      game.routeIndex = Math.min(game.routeIndex + (opt.advance||1), game.routeCities.length-1);
      game.todayTimeDelta = opt.timeDelta || 0; // store for nightly rollover
      const newCity = currentCity();

      pushCsvRow('travel', (isCoco?`Coco: ${opt.label}`:opt.label), priorCity, newCity);
      game.log.push({type:'travel', msg:`Day ${game.day}: ${isCoco?'Coco':'Player'} chose ${opt.label} (${fmtTravel(opt)}) ‚Äî ${priorCity} ‚Üí ${newCity}`});
      updateDash();
      if(checkEnd()) return;
      game.phase='stay'; screenStay();
    }

    function screenStay(){
      if(checkEnd()) return;
      app.innerHTML = html`
        <div class="card">
          <div class="toolbar"><div>\${progressBar()}</div><div class="right"><button class="btn chip" id="btnExport">‚¨áÔ∏è Download CSV</button></div></div>
          <h2>Evening ‚Äî Where will you stay?</h2>
          <div id="stayList"></div>
        </div>
      `;
      document.getElementById('btnExport').onclick = exportCSV;
      const list=document.getElementById('stayList');
      stayOptions.forEach(s=>{
        const div=document.createElement('div');
        div.className='choice';
        div.innerHTML = `
          <div>üõéÔ∏è</div>
          <div>
            <h4>\${s.label}</h4>
            <div>\${s.detail}</div>
            <div style="margin-top:8px" class="row"><button class="btn" data-key="\${s.key}">Choose \${s.label}</button></div>
          </div>`;
        list.appendChild(div);
      });
      list.querySelectorAll('button[data-key]').forEach(btn=>{
        btn.onclick=()=>{
          const s = stayOptions.find(x=>x.key===btn.dataset.key);
          game.money = Math.max(0, game.money + s.cost);
          game.energy = clamp(game.energy + s.energy, 0, 100);
          game.mood = clamp(game.mood + (s.mood||0), 0, 100);
          pushCsvRow('stay', s.label, currentCity(), currentCity());
          game.log.push({type:'stay', msg:`Stayed: ${s.label} (${s.detail})`});
          updateDash();
          if(checkEnd()) return;
          game.phase='food'; screenFood();
        };
      });
    }

    function screenFood(){
      app.innerHTML = html`
        <div class="card">
          <div class="toolbar"><div>\${progressBar()}</div><div class="right"><button class="btn chip" id="btnExport">‚¨áÔ∏è Download CSV</button></div></div>
          <h2>Food ‚Äî Refuel?</h2>
          <div id="foodList"></div>
          <div class="row" style="margin-top:8px"><button class="btn ghost" id="skipFood">Skip food phase</button></div>
        </div>
      `;
      document.getElementById('btnExport').onclick = exportCSV;
      const list=document.getElementById('foodList');
      foodOptions.forEach(f=>{
        const div=document.createElement('div');
        div.className='choice';
        div.innerHTML = `
          <div>üçΩÔ∏è</div>
          <div>
            <h4>\${f.label}</h4>
            <div>\${f.detail}</div>
            <div style="margin-top:8px" class="row"><button class="btn" data-key="\${f.key}">Choose \${f.label}</button></div>
          </div>`;
        list.appendChild(div);
      });
      list.querySelectorAll('button[data-key]').forEach(btn=>{
        btn.onclick=()=>{
          const f = foodOptions.find(x=>x.key===btn.dataset.key);
          game.money = Math.max(0, game.money + f.cost);
          game.energy = clamp(game.energy + f.energy, 0, 100);
          game.mood = clamp(game.mood + (f.mood||0), 0, 100);
          pushCsvRow('food', f.label, currentCity(), currentCity());
          game.log.push({type:'food', msg:`Ate: ${f.label} (${f.detail})`});
          updateDash(); if(checkEnd()) return; nextDayEvent();
        };
      });
      document.getElementById('skipFood').onclick=()=>{ pushCsvRow('food','Skip', currentCity(), currentCity()); nextDayEvent(); };
    }

    function nextDayEvent(){
      // Nightly rollover: subtract exactly once per "day"
      const dayCost = 1 + (game.todayTimeDelta || 0);
      game.time = Math.max(0, game.time - dayCost);

      // Then random event may add/subtract resources (including time)
      const ev = randomEvent();
      let note = 'No events today.'; if(ev){ note = ev.effect(); }
      game.log.push({type:'event', msg: note});
      pushCsvRow('event', note, currentCity(), currentCity());

      updateDash();
      if(checkEnd()) return;

      // Advance to next calendar day and continue
      if(game.routeIndex >= game.routeCities.length-1){ endGame(true); return; }
      game.day += 1;
      game.todayTimeDelta = 0;
      game.phase='travel';
      screenTravel();
    }

    function checkEnd(){
      if(game.routeIndex >= game.routeCities.length-1){ endGame(true); return true; }
      if(game.money<=0){ endGame(false,'You ran out of money.'); return true; }
      if(game.time<=0){ endGame(false,'You ran out of time.'); return true; }
      if(game.energy<=0){ endGame(false,'You collapsed from exhaustion.'); return true; }
      return false;
    }

    function endGame(win, reason=''){
      game.phase='end';
      const score = (win?50:0) + game.money + game.energy + game.time + (game.mood>=80?10:0) - (game.mood<20?10:0);
      const story = game.log.map(l=>`‚Ä¢ ${l.msg}`).join('\n');
      const routeStr = `${startCity()} ‚Üí ${destination()}`;
      const arrived = game.routeIndex >= game.routeCities.length-1;
      const title = win && arrived ? 'üéâ You arrived!' : (win ? 'üéâ Progress complete' : 'üí• Trip over');
      const summary = win && arrived ? 'Destination reached.' : (win ? 'Route milestones cleared.' : reason);

      app.innerHTML = html`
        <div class="card">
          <div class="toolbar"><div>\${progressBar()}</div><div class="right"><button class="btn chip" id="btnExport">‚¨áÔ∏è Download CSV</button></div></div>
          <h2>\${title}</h2>
          \${summary?html`<p class="muted">\${summary}</p>`:''}
          <p><strong>Route:</strong> \${routeStr}</p>
          <p><strong>Final resources:</strong> ¬£\${game.money}, \${game.time} day(s), \${game.energy} energy, mood \${game.mood}</p>
          <p><strong>Coco followed:</strong> \${game.followedCocoCount} time(s). Ignored: \${game.ignoredCocoCount}.</p>
          <p><strong>Score:</strong> \${score}</p>
          <details style="margin-top:8px"><summary>Trip Story (log)</summary><pre style="white-space:pre-wrap;background:#fafafa;border:1px solid var(--border);padding:10px;border-radius:12px">\${story}</pre></details>
          <div class="row" style="margin-top:12px">
            <button class="btn" id="restart">Play again</button>
          </div>
        </div>
      `;
      document.getElementById('btnExport').onclick = exportCSV;
      document.getElementById('restart').onclick = ()=>{ game.phase='start'; screenStart(); updateDash(); };
    }

    // Init
    updateDash();
    screenStart();
  </script>
</body>
</html>
